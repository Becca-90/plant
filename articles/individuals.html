<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Individual-level properties • plant</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="Individual-level properties">
<meta property="og:description" content="plant">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">plant</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../articles/plant.html">
    <span class="fas fa-tree"></span>
     
    Getting Started
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fas fa-list"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Theory
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/demography.html">Demography of plants, patches, and metacommunities</a>
    </li>
    <li>
      <a href="../articles/physiology.html">The FF16 strategy</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-file-code-o"></span>
     
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/individuals.html">Individual plants</a>
    </li>
    <li>
      <a href="../articles/patch.html">Patches of competing plants</a>
    </li>
    <li>
      <a href="../articles/equilibrium.html">Finding demographic equilibrium</a>
    </li>
    <li>
      <a href="../articles/emergent.html">Emergent properties of patches</a>
    </li>
    <li>
      <a href="../articles/fitness.html">Calculating fitness</a>
    </li>
    <li>
      <a href="../articles/cohort_spacing.html">The cohort spacing algorithm</a>
    </li>
    <li>
      <a href="../articles/parameters.html">Changing parameters</a>
    </li>
    <li>
      <a href="../articles/strategy.html">Implementing a new strategy</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/developer_notes.html">
    <span class="fas fa-terminal"></span>
     
    Developer Notes
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../news/index.html">
    <span class="fas fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/traitecoevo/plant">
    <span class="fas fa-github fa-lg"></span>
     
    Github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Individual-level properties</h1>
                        <h4 class="author">Rich FitzJohn</h4>
                        <h4 class="author">Daniel Falster</h4>
            
            <h4 class="date">2016</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/traitecoevo/plant/blob/master/vignettes/individuals.Rmd"><code>vignettes/individuals.Rmd</code></a></small>
      <div class="hidden name"><code>individuals.Rmd</code></div>

    </div>

    
    
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p>Any <code>plant</code> model defines a strategy that implements a system of equations describing the change of one or more characteristics (state variables) of individuals. These individuals are aggregated as cohorts of different ages that compete within a patch.</p>
<p>This vignette illustrates the how to model the dynamics of individuals and the analysis used to generate figure (Fig 2) in the manuscript. Throughout we use the <code>FF16</code> strategy, describing the Falster Fitzjohn model of light competition in forest stands, however an equivalent <code>Individual</code> component of the model will be present in all strategies.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/traitecoevo/plant">plant</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="individuals" class="section level1">
<h1 class="hasAnchor">
<a href="#individuals" class="anchor"></a>Individuals</h1>
<p>Individuals are constructed with the <code>FF16_Individual</code> function. That function takes as its only argument a “strategy” object; the default is <code>FF16_Strategy</code>, but alternative strategies can be provided (see below). The “strategy” object contains all the physiological underpinning the dynamics of individual plants and entire meta-populations.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FF16_Individual.html">FF16_Individual</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Individuals are an <a href="https://github.com/wch/R6">R6</a> class, and have a number of elements and fields that can be accessed:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span></code></pre></div>
<pre><code>## &lt;Individual&lt;FF16,FF16_Env&gt;&gt;
##   Inherits from: &lt;Individual&gt;
##   Public:
##     .ptr: externalptr
##     aux: function (name) 
##     aux_names: active binding
##     aux_size: active binding
##     clone: function (deep = FALSE) 
##     compute_competition: function (h) 
##     compute_rates: function (environment) 
##     establishment_probability: function (environment) 
##     initialize: function (ptr) 
##     internals: active binding
##     lcp_whole_plant: function () 
##     mortality_probability: active binding
##     net_mass_production_dt: function (environment) 
##     ode_names: active binding
##     ode_rates: active binding
##     ode_size: active binding
##     ode_state: active binding
##     rate: function (name) 
##     reset_mortality: function () 
##     set_state: function (name, v) 
##     state: function (name) 
##     strategy: active binding
##     strategy_name: active binding</code></pre>
<p>Things labelled ‘active binding’ are “fields” and can be read from and (sometimes) set:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="st">"height"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.3441948</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span><span class="op">$</span><span class="fu">set_state</span><span class="op">(</span><span class="st">"height"</span>, <span class="fl">10</span><span class="op">)</span>
<span class="va">indv</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="st">"height"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 10</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="st">"fecundity"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="st">"mortality"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>Height, fecundity and mortality are the three key variables of the FF16 strategy, each propagated by the internal system of differential equations:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span><span class="op">$</span><span class="va">ode_state</span></code></pre></div>
<pre><code>## [1] 10  0  0  0  0</code></pre>
<p>While we can get and set variable state for a single individual, computing the rates of change requires information about the environment an individual inhabits. In the FF16 model, individuals compete through a shared light environment, described in terms of canopy openness. The function <code>fixed_environment</code> creates an environment that has the same canopy openness (here 100%) at all heights. <em>Note: The <code>indv</code> individual does not affect this light environment</em>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FF16_Environment.html">FF16_fixed_environment</a></span><span class="op">(</span><span class="fl">1.0</span><span class="op">)</span></code></pre></div>
<p>In the FF16 model, the <code>compute_rates</code> method computes net mass production for the individual, and from that demographic rates:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span><span class="op">$</span><span class="va">ode_rates</span></code></pre></div>
<pre><code>## [1] NA NA NA NA NA</code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span><span class="op">$</span><span class="fu">compute_rates</span><span class="op">(</span><span class="va">env</span><span class="op">)</span>
<span class="va">indv</span><span class="op">$</span><span class="va">ode_rates</span></code></pre></div>
<pre><code>## [1] 9.231625e-01 1.002618e-02 6.905594e-05 3.132290e-04 1.687620e+00</code></pre>
<!-- TODO: next bit is a bit vague -->
<p>While we have focused on three key variables, height, mortality and fecundity, the FF16 model describes variable for five characteristics. The name vector of these variables is available via</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span><span class="op">$</span><span class="va">ode_names</span></code></pre></div>
<pre><code>## [1] "height"         "mortality"      "fecundity"      "area_heartwood" "mass_heartwood"</code></pre>
<p>There is also a function to directly access particular rates:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span><span class="op">$</span><span class="fu">rate</span><span class="op">(</span><span class="st">"height"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.9231625</code></pre>
<p>Individuals are a type of <em>reference object</em>. They are different to almost every other R object you regularly interact with in that they do not make copies when you rename them, meaning changes to one will be reflected in another.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv2</span> <span class="op">&lt;-</span> <span class="va">indv</span>
<span class="va">indv2</span><span class="op">$</span><span class="fu">set_state</span><span class="op">(</span><span class="st">"height"</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">indv2</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="st">"height"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="st">"height"</span><span class="op">)</span> <span class="co"># also 1!</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>There’s not actually that much that can be done with Individual objects; they’re designed to be small and light to work well with the larger simulation code that does not particularly care about most of the internal calculations.</p>
</div>
<div id="growing-plants" class="section level1">
<h1 class="hasAnchor">
<a href="#growing-plants" class="anchor"></a>Growing plants</h1>
<p>Rather than setting the size of Individuals to given values, it will often be required to <em>grow</em> them to a size. In the FF16 model, this allows us to compute seed output (integrated over the plant’s lifetime) stem diameter, survival, etc; basically everything except for height.</p>
<p>It’s possible to directly integrate the equations exposed by the Individual, using the <code>ode_state</code> field, <code>compute_rates</code> method and <code>ode_rates</code> field. For example, we can use the R package <code>deSolve</code>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># deSolve wrapper of Individual ODEs</span>
<span class="va">derivs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">individual</span>, <span class="va">env</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">individual</span><span class="op">$</span><span class="va">ode_state</span> <span class="op">&lt;-</span> <span class="va">y</span>
  <span class="va">individual</span><span class="op">$</span><span class="fu">compute_rates</span><span class="op">(</span><span class="va">env</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">individual</span><span class="op">$</span><span class="va">ode_rates</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># initialise indiidual, timesteps and initial conditions</span>
<span class="va">indv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FF16_Individual.html">FF16_Individual</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span>, length.out<span class="op">=</span><span class="fl">101</span><span class="op">)</span>
<span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">indv</span><span class="op">$</span><span class="va">ode_state</span>, <span class="va">indv</span><span class="op">$</span><span class="va">ode_names</span><span class="op">)</span>

<span class="co"># solve and plot</span>
<span class="va">yy</span> <span class="op">&lt;-</span> <span class="fu">deSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/lsoda.html">lsoda</a></span><span class="op">(</span><span class="va">y0</span>, <span class="va">tt</span>, <span class="va">derivs</span>, <span class="va">indv</span>, env<span class="op">=</span><span class="va">env</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">height</span> <span class="op">~</span> <span class="va">time</span>, <span class="va">yy</span>, type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></code></pre></div>
<p><img src="figure/individuals__unnamed-chunk-11-1.png"></p>
<p>Alternatively, it might desirable to grow a Individual to a particular size. We could interpolate from the previous results easily enough. E.g., to find a plant with height of 15 m:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">15.0</span></code></pre></div>
<p>that happened approximately here:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/splinefun.html">spline</a></span><span class="op">(</span><span class="va">yy</span><span class="op">[</span>, <span class="st">"height"</span><span class="op">]</span>, <span class="va">yy</span><span class="op">[</span>, <span class="st">"time"</span><span class="op">]</span>, xout<span class="op">=</span><span class="va">h</span><span class="op">)</span><span class="op">$</span><span class="va">y</span></code></pre></div>
<p>Interpolate to find the state:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">yy</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/splinefun.html">spline</a></span><span class="op">(</span><span class="va">yy</span><span class="op">[</span>, <span class="st">"time"</span><span class="op">]</span>, <span class="va">y</span>, xout<span class="op">=</span><span class="va">t</span><span class="op">)</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>

<span class="va">indv2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FF16_Individual.html">FF16_Individual</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">indv2</span><span class="op">$</span><span class="va">ode_state</span> <span class="op">&lt;-</span> <span class="va">y</span>
<span class="va">indv2</span><span class="op">$</span><span class="fu">compute_rates</span><span class="op">(</span><span class="va">env</span><span class="op">)</span></code></pre></div>
<p>Plant is expected height:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv2</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="st">"height"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 15</code></pre>
<p>And at this height, here is the total seed production:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv2</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="st">"fecundity"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 289.9376</code></pre>
<p>To make this type of operation easier, we provide the function <code>grow_plant_to_time</code></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grow_plant_to_time.html">grow_plant_to_time</a></span><span class="op">(</span><span class="fu"><a href="../reference/FF16_Individual.html">FF16_Individual</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">tt</span>, <span class="va">env</span><span class="op">)</span></code></pre></div>
<p>Here is the result using the internal ODE solver (black line), plotted against the result obtained from using <code>deSolve</code> above (grey dots):</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">height</span> <span class="op">~</span> <span class="va">tt</span>, <span class="va">res</span><span class="op">$</span><span class="va">state</span>, type<span class="op">=</span><span class="st">"l"</span>, las<span class="op">=</span><span class="fl">1</span>,
     xlab<span class="op">=</span><span class="st">"Time (years)"</span>, ylab<span class="op">=</span><span class="st">"Height (m)"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">height</span> <span class="op">~</span> <span class="va">time</span>, <span class="va">yy</span>, col<span class="op">=</span><span class="st">"grey"</span>, cex<span class="op">=</span><span class="fl">.5</span><span class="op">)</span></code></pre></div>
<p><img src="figure/individuals__unnamed-chunk-18-1.png"></p>
<p>Completing the set, <code>plant</code> also provides a function for growing individuals to a particular size; <code>grow_plant_to_size</code>. This takes <em>any</em> size measurement in the individuals and can grow the individuals to that size. So, for height:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create a sequence from the initial size to height at maturity</span>
<span class="va">indv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FF16_Individual.html">FF16_Individual</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">heights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">indv</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="st">"height"</span><span class="op">)</span>, <span class="va">indv</span><span class="op">$</span><span class="va">strategy</span><span class="op">$</span><span class="va">hmat</span>, length.out<span class="op">=</span><span class="fl">20</span><span class="op">)</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grow_plant_to_size.html">grow_plant_to_size</a></span><span class="op">(</span><span class="va">indv</span>, <span class="va">heights</span>, <span class="st">"height"</span>, <span class="va">env</span><span class="op">)</span></code></pre></div>
<p>This returns a vector of times; this is when the heights were achieved</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span><span class="op">$</span><span class="va">time</span></code></pre></div>
<pre><code>##  [1]  0.000000  1.545681  2.523393  3.365033  4.155087  4.926508  5.696593  6.476387  7.274127  8.096757  8.950785  9.842785 10.779771 11.769706 12.821689 13.946774 15.158668 16.476692 17.957500 20.137320</code></pre>
<p>A matrix of states, showing the state of related characteristics:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">state</span><span class="op">)</span></code></pre></div>
<pre><code>##         height  mortality    fecundity area_heartwood mass_heartwood
## [1,] 0.3441948 0.00000000 0.000000e+00   0.000000e+00   0.000000e+00
## [2,] 1.1995465 0.01545682 7.754892e-20   1.280271e-07   6.544158e-05
## [3,] 2.0548958 0.02523396 5.654011e-18   9.826616e-07   8.617440e-04
## [4,] 2.9102485 0.03365038 2.252986e-16   3.837305e-06   4.790943e-03
## [5,] 3.7656006 0.04155098 6.750246e-15   1.081677e-05   1.755419e-02
## [6,] 4.6209512 0.04926531 1.710259e-13   2.510437e-05   5.019027e-02</code></pre>
<p>And a list of individualss</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span><span class="op">$</span><span class="va">plant</span><span class="op">[[</span><span class="fl">10</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>## &lt;Individual&lt;FF16,FF16_Env&gt;&gt;
##   Inherits from: &lt;Individual&gt;
##   Public:
##     .ptr: externalptr
##     aux: function (name) 
##     aux_names: active binding
##     aux_size: active binding
##     clone: function (deep = FALSE) 
##     compute_competition: function (h) 
##     compute_rates: function (environment) 
##     establishment_probability: function (environment) 
##     initialize: function (ptr) 
##     internals: active binding
##     lcp_whole_plant: function () 
##     mortality_probability: active binding
##     net_mass_production_dt: function (environment) 
##     ode_names: active binding
##     ode_rates: active binding
##     ode_size: active binding
##     ode_state: active binding
##     rate: function (name) 
##     reset_mortality: function () 
##     set_state: function (name, v) 
##     state: function (name) 
##     strategy: active binding
##     strategy_name: active binding</code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span><span class="op">$</span><span class="va">plant</span><span class="op">[[</span><span class="fl">10</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="st">"height"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 8.042356</code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">heights</span><span class="op">[[</span><span class="fl">10</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>## [1] 8.042356</code></pre>
</div>
<div id="comparing-individuals" class="section level1">
<h1 class="hasAnchor">
<a href="#comparing-individuals" class="anchor"></a>Comparing individuals</h1>
<p>With all relevant components in place, let’s look at growth trajectories of individuals of two species that differ in their trait values. This presented in Fig. 2a of the paper.</p>
<p>Note that we’re using an alternative way of specifying strategies here, to trigger our “hyper-parameterisation” approach. This allows us to relate the values of one trait, here leaf-mass area (LMA), to other traits that form fundamental trade-offs in plant physiology. This may be simplified in future, but currently the “hyper-parameterisation” function resides on the <code>params</code> object.</p>
<p>First, we load the FF16 strategy pre-populated with a set of default parameters</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scm_base_parameters.html">scm_base_parameters</a></span><span class="op">(</span><span class="st">"FF16"</span><span class="op">)</span></code></pre></div>
<p>Then we can use the <code>params</code> object to set a low LMA (“fast growth”) species:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/strategy_list.html">strategy</a></span><span class="op">(</span><span class="fu"><a href="../reference/trait_matrix.html">trait_matrix</a></span><span class="op">(</span><span class="fl">0.0825</span>,  <span class="st">"lma"</span><span class="op">)</span>, <span class="va">params</span><span class="op">)</span></code></pre></div>
<p>and a high LMA (“low growth”) species:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/strategy_list.html">strategy</a></span><span class="op">(</span><span class="fu"><a href="../reference/trait_matrix.html">trait_matrix</a></span><span class="op">(</span><span class="fl">0.2625</span>, <span class="st">"lma"</span><span class="op">)</span>, <span class="va">params</span><span class="op">)</span></code></pre></div>
<p>In the FF16 model, LMA is related to leaf turnover (<code>k_l</code>) and the ratio of dark respiration to leaf mass (<code>r_l</code>):</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">s1</span>, <span class="va">s2</span><span class="op">)</span>, <span class="va">`[`</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lma"</span>, <span class="st">"k_l"</span>, <span class="st">"r_l"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [[1]]$lma
## [1] 0.0825
## 
## [[1]]$k_l
## [1] 2.03812
## 
## [[1]]$r_l
## [1] 476
## 
## 
## [[2]]
## [[2]]$lma
## [1] 0.2625
## 
## [[2]]$k_l
## [1] 0.2816144
## 
## [[2]]$r_l
## [1] 149.6</code></pre>
<p>We use these specific strategies to create Individuals:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FF16_Individual.html">FF16_Individual</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span>
<span class="va">indv2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FF16_Individual.html">FF16_Individual</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span></code></pre></div>
<p>Then, collect information of their characteristic variables over a sequence of heights. Note that range of heights are different for the two Individuals because they have different starting heights. The lower LMA of s1 allows it to achieve a greater initial height for given seed mass.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">heights1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">indv1</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="st">"height"</span><span class="op">)</span>, <span class="va">s1</span><span class="op">$</span><span class="va">hmat</span>, length.out<span class="op">=</span><span class="fl">100L</span><span class="op">)</span>
<span class="va">heights2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">indv2</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="st">"height"</span><span class="op">)</span>, <span class="va">s2</span><span class="op">$</span><span class="va">hmat</span>, length.out<span class="op">=</span><span class="fl">100L</span><span class="op">)</span>

<span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grow_plant_to_size.html">grow_plant_to_height</a></span><span class="op">(</span><span class="va">indv1</span>, <span class="va">heights1</span>, <span class="va">env</span>,
                             time_max<span class="op">=</span><span class="fl">100</span>, warn<span class="op">=</span><span class="cn">FALSE</span>, filter<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">dat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grow_plant_to_size.html">grow_plant_to_height</a></span><span class="op">(</span><span class="va">indv2</span>, <span class="va">heights2</span>, <span class="va">env</span>,
                             time_max<span class="op">=</span><span class="fl">100</span>, warn<span class="op">=</span><span class="cn">FALSE</span>, filter<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">$</span><span class="va">trajectory</span><span class="op">[</span>, <span class="st">"time"</span><span class="op">]</span>, <span class="va">dat1</span><span class="op">$</span><span class="va">trajectory</span><span class="op">[</span>, <span class="st">"height"</span><span class="op">]</span>,
     type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="fl">1</span>,
     las<span class="op">=</span><span class="fl">1</span>, xlab<span class="op">=</span><span class="st">"Time (years)"</span>, ylab<span class="op">=</span><span class="st">"Height (m)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">$</span><span class="va">trajectory</span><span class="op">[</span>, <span class="st">"time"</span><span class="op">]</span>, <span class="va">dat2</span><span class="op">$</span><span class="va">trajectory</span><span class="op">[</span>, <span class="st">"height"</span><span class="op">]</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Low LMA"</span>, <span class="st">"High LMA"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></code></pre></div>
<p><img src="figure/individuals__unnamed-chunk-28-1.png"></p>
<p>We cam see each species fares under lower light:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env_low</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FF16_Environment.html">FF16_fixed_environment</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>
<span class="va">dat1_low</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grow_plant_to_size.html">grow_plant_to_height</a></span><span class="op">(</span><span class="va">indv1</span>, <span class="va">heights1</span>, <span class="va">env_low</span>,
                                 time_max<span class="op">=</span><span class="fl">100</span>, warn<span class="op">=</span><span class="cn">FALSE</span>, filter<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">dat2_low</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grow_plant_to_size.html">grow_plant_to_height</a></span><span class="op">(</span><span class="va">indv2</span>, <span class="va">heights2</span>, <span class="va">env_low</span>,
                                 time_max<span class="op">=</span><span class="fl">100</span>, warn<span class="op">=</span><span class="cn">FALSE</span>, filter<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"#e34a33"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">$</span><span class="va">trajectory</span><span class="op">[</span>, <span class="st">"time"</span><span class="op">]</span>, <span class="va">dat1</span><span class="op">$</span><span class="va">trajectory</span><span class="op">[</span>, <span class="st">"height"</span><span class="op">]</span>,
     type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="fl">1</span>,
     las<span class="op">=</span><span class="fl">1</span>, xlab<span class="op">=</span><span class="st">"Time (years)"</span>, ylab<span class="op">=</span><span class="st">"Height (m)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">$</span><span class="va">trajectory</span><span class="op">[</span>, <span class="st">"time"</span><span class="op">]</span>, <span class="va">dat2</span><span class="op">$</span><span class="va">trajectory</span><span class="op">[</span>, <span class="st">"height"</span><span class="op">]</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">dat1_low</span><span class="op">$</span><span class="va">trajectory</span><span class="op">[</span>, <span class="st">"time"</span><span class="op">]</span>, <span class="va">dat1_low</span><span class="op">$</span><span class="va">trajectory</span><span class="op">[</span>, <span class="st">"height"</span><span class="op">]</span>,
      lty<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="va">cols</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">dat2_low</span><span class="op">$</span><span class="va">trajectory</span><span class="op">[</span>, <span class="st">"time"</span><span class="op">]</span>, <span class="va">dat2_low</span><span class="op">$</span><span class="va">trajectory</span><span class="op">[</span>, <span class="st">"height"</span><span class="op">]</span>,
      lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="va">cols</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>,
       <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"High light"</span>, <span class="st">"Low light"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="va">cols</span>,
       bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></code></pre></div>
<p><img src="figure/individuals__unnamed-chunk-29-1.png"></p>
<p>The <em>height growth rate</em> is the derivative of height with respect to time - the slope of the plot above. It is really the core quantity in the model; the actual heights are computed by solving the set of ODEs that includes height growth rate.</p>
<p>Growth rate with respect to height shows a hump-shaped pattern that is affected by both traits and by light environment. To extract this information from the trajectories takes a little more work though.</p>
<p>Here is an inidivdual from part way through one run</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span> <span class="op">&lt;-</span> <span class="va">dat1</span><span class="op">$</span><span class="va">plant</span><span class="op">[[</span><span class="fl">50</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p>Here is the set of ODE state variables:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">indv</span><span class="op">$</span><span class="va">ode_state</span>, <span class="va">indv</span><span class="op">$</span><span class="va">ode_names</span><span class="op">)</span></code></pre></div>
<pre><code>##         height      mortality      fecundity area_heartwood mass_heartwood 
##   8.412120e+00   7.797210e-02   9.998839e-08   3.403727e-04   1.262008e+00</code></pre>
<p>And the set of <em>rate</em> variables</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">indv</span><span class="op">$</span><span class="va">ode_rates</span>, <span class="va">indv</span><span class="op">$</span><span class="va">ode_names</span><span class="op">)</span></code></pre></div>
<pre><code>##         height      mortality      fecundity area_heartwood mass_heartwood 
##   9.530474e-01   1.003019e-02   3.243850e-07   1.780143e-04   8.068135e-01</code></pre>
<p>…however, the rates might not be correct. They are whatever was left by the ODE stepper when it was advancing the plant, so it’s best to update them:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span><span class="op">$</span><span class="fu">compute_rates</span><span class="op">(</span><span class="va">dat1</span><span class="op">$</span><span class="va">env</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">indv</span><span class="op">$</span><span class="va">ode_rates</span>, <span class="va">indv</span><span class="op">$</span><span class="va">ode_names</span><span class="op">)</span></code></pre></div>
<pre><code>##         height      mortality      fecundity area_heartwood mass_heartwood 
##   9.530474e-01   1.003019e-02   3.243850e-07   1.780143e-04   8.068135e-01</code></pre>
<p>(in this case they are the same because the light environment is unchanging, but that not be the case generally)</p>
<p>Alternatively, we can access the height growth rate via the internals, which is the same as accessing directly from the ODE rates but more explicit:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span><span class="op">$</span><span class="fu">rate</span><span class="op">(</span><span class="st">"height"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.9530474</code></pre>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span><span class="op">$</span><span class="va">ode_rates</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>## [1] 0.9530474</code></pre>
<p>Collecting height growth for high and low LMA individauls in high and low light environments:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="fu">rate</span><span class="op">(</span><span class="st">"height"</span><span class="op">)</span>
<span class="va">dhdt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">$</span><span class="va">plant</span>, <span class="va">f</span><span class="op">)</span>
<span class="va">dhdt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">$</span><span class="va">plant</span>, <span class="va">f</span><span class="op">)</span>
<span class="va">dhdt1_low</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">dat1_low</span><span class="op">$</span><span class="va">plant</span>, <span class="va">f</span><span class="op">)</span>
<span class="va">dhdt2_low</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">dat2_low</span><span class="op">$</span><span class="va">plant</span>, <span class="va">f</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">$</span><span class="va">time</span>, <span class="va">dhdt1</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="fl">1</span>,
     las<span class="op">=</span><span class="fl">1</span>, xlab<span class="op">=</span><span class="st">"Time (years)"</span>, ylab<span class="op">=</span><span class="st">"Height growth rate (m / yr)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">$</span><span class="va">time</span>, <span class="va">dhdt2</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">dat1_low</span><span class="op">$</span><span class="va">time</span>, <span class="va">dhdt1_low</span>, lty<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="va">cols</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">dat2_low</span><span class="op">$</span><span class="va">time</span>, <span class="va">dhdt2_low</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="va">cols</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,
       <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"High light"</span>, <span class="st">"Low light"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="va">cols</span>,
       bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></code></pre></div>
<p><img src="figure/individuals__unnamed-chunk-35-1.png"></p>
<p>Alternatively, change in height plotted against height itself:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">dhdt1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">$</span><span class="va">state</span><span class="op">[</span>, <span class="st">"height"</span><span class="op">]</span>, <span class="va">dhdt1</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="fl">1</span>,
     las<span class="op">=</span><span class="fl">1</span>, xlab<span class="op">=</span><span class="st">"Height (m)"</span>, ylab<span class="op">=</span><span class="st">"Height growth rate (m / yr)"</span>, ylim<span class="op">=</span><span class="va">ylim</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">$</span><span class="va">state</span><span class="op">[</span>, <span class="st">"height"</span><span class="op">]</span>, <span class="va">dhdt2</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">dat1_low</span><span class="op">$</span><span class="va">state</span><span class="op">[</span>, <span class="st">"height"</span><span class="op">]</span>, <span class="va">dhdt1_low</span>, lty<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="va">cols</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">dat2_low</span><span class="op">$</span><span class="va">state</span><span class="op">[</span>, <span class="st">"height"</span><span class="op">]</span>, <span class="va">dhdt2_low</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="va">cols</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,
       <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"High light"</span>, <span class="st">"Low light"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="va">cols</span>,
       bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></code></pre></div>
<p><img src="figure/individuals__unnamed-chunk-36-1.png"></p>
<!--
TODO: Remove Plant Plus
Over a plant's life, allocation to different structures varies.
This is captured by a set of variables stored within the internals:
e.g., `mass_leaf` `mass_sapwood`.
```{}
indv$internals$mass_leaf
indv$internals$mass_sapwood
```

(these numbers seem a bit off: one of the motivations here is to
develop and use better models of plant allometry.  The
parameterisation used at present are derived from adults and
perform poorly with small plants.  However, based on height / area
relationships [Falster 2011, supporting information], for an 8m
tall plant total leaf areas of 5-10 m are plausible and with an LMA
of 0.08 that implies a total *dry* weight of 400 - 800 g).

Total live dry mass fraction to leaf and stem can be computed as:
```{}
f <- function(p) {
  p_ints <- p$internals
  c(leaf=p_ints$mass_leaf / p_ints$mass_live,
    sapwood=p_ints$mass_sapwood / p_ints$mass_live)
}

cols_part <- c("black", "#045a8d")
matplot(dat1$state[, "height"], t(sapply(dat1$plant, f)),
        type="l", col=cols_part, lty=1, ylim=c(0, 1),
        xlab="Height (m)", ylab="Fractional allocation", las=1)
matlines(dat2$state[, "height"], t(sapply(dat2$plant, f)),
         col=cols_part, lty=2)
legend("topright", c("Sapwood", "Leaf"), lty=1, col=rev(cols_part), bty="n")
```

Relative allocation to leaf mass drops steeply as a plant grows and
is replaced by allocation to sapwood mass.
-->
<p>The growth rates vary with both size and light environment (see above).</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FF16_Individual.html">FF16_Individual</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">indv</span><span class="op">$</span><span class="fu">set_state</span><span class="op">(</span><span class="st">"height"</span>, <span class="fl">10</span><span class="op">)</span>
<span class="va">indv</span><span class="op">$</span><span class="fu">compute_rates</span><span class="op">(</span><span class="fu"><a href="../reference/FF16_Environment.html">FF16_fixed_environment</a></span><span class="op">(</span><span class="fl">1.0</span><span class="op">)</span><span class="op">)</span>
<span class="va">indv</span><span class="op">$</span><span class="fu">rate</span><span class="op">(</span><span class="st">"height"</span><span class="op">)</span> <span class="co"># in full light</span></code></pre></div>
<pre><code>## [1] 0.9231625</code></pre>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span><span class="op">$</span><span class="fu">compute_rates</span><span class="op">(</span><span class="fu"><a href="../reference/FF16_Environment.html">FF16_fixed_environment</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="va">indv</span><span class="op">$</span><span class="fu">rate</span><span class="op">(</span><span class="st">"height"</span><span class="op">)</span> <span class="co"># in 1/2 light</span></code></pre></div>
<pre><code>## [1] 0.4522332</code></pre>
<p>At some point the individual cannot maintain positive carbon balance and therefore cannot grow; for example at 25% canopy openness</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indv</span><span class="op">$</span><span class="fu">compute_rates</span><span class="op">(</span><span class="fu"><a href="../reference/FF16_Environment.html">FF16_fixed_environment</a></span><span class="op">(</span><span class="fl">0.25</span><span class="op">)</span><span class="op">)</span>
<span class="va">indv</span><span class="op">$</span><span class="fu">rate</span><span class="op">(</span><span class="st">"height"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>The light level at which carbon gain becomes zero is the “whole plant light compensation point”.</p>
<!-- TODO: Remove below once lcp works -->
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">openness</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out<span class="op">=</span><span class="fl">51</span><span class="op">)</span>
<span class="va">lcp</span> <span class="op">&lt;-</span> <span class="fl">0.299</span></code></pre></div>
<p>Height growth rate increases in a saturating fashion with increasing canopy openness from the light compensation point.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">indv</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FF16_Environment.html">FF16_fixed_environment</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="va">indv</span><span class="op">$</span><span class="fu">compute_rates</span><span class="op">(</span><span class="va">env</span><span class="op">)</span>
  <span class="va">indv</span><span class="op">$</span><span class="fu">rate</span><span class="op">(</span><span class="st">"height"</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">lcp</span>, <span class="va">openness</span><span class="op">[</span><span class="va">openness</span> <span class="op">&gt;</span> <span class="va">lcp</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">f</span>, <span class="va">indv</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,
     las<span class="op">=</span><span class="fl">1</span>, xlab<span class="op">=</span><span class="st">"Canopy openness"</span>, ylab<span class="op">=</span><span class="st">"Height growth rate (m / yr)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">lcp</span>, <span class="fl">0.0</span>, pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span></code></pre></div>
<p><img src="figure/individuals__unnamed-chunk-40-1.png"></p>
<!-- TODO: refactor once lcp works

Now, consider this for a seedling and for a plant at half its
maximum size
size:
```{ }
indv_seed <- FF16_Individual(s1)
y_seed <- g(openness, indv_seed)
indv_adult <- FF16_Individual(s1)
indv_adult$state("height", indv_adult$strategy$hmat / 2)
y_adult <- g(openness, indv_adult)
cols_height <- c("#31a354", "black")

ymax <- max(y_seed[, 2], y_adult[, 2])
plot(y_seed, type="l", col=cols_height[[1]],
     xlim=c(0, 1), ylim=c(0, ymax), las=1,
     xlab="Canopy openness", ylab="Height growth year (m / yr)")
lines(y_adult, col=cols_height[[2]])
legend("bottomright", c("Seedling", "Adult"), lty=1, col=cols_height, bty="n")
```

The light compensation point and curve varies with traits, too:
```{ }
pl2_seed <- FF16_IndividualPlus(s2)
pl2_adult <- FF16_IndividualPlus(s2)
pl2_adult$height <- pl2_adult$strategy$hmat / 2
y2_seed <- g(openness, pl2_seed)
y2_adult <- g(openness, pl2_adult)

ymax <- max(ymax, y2_seed[, 2], y2_adult[, 2])
plot(y_seed, type="l", col=cols_height[[1]],
     xlim=c(0, 1), ylim=c(0, ymax), las=1,
     xlab="Canopy openness", ylab="Height growth year (m / yr)")
lines(y_adult, col=cols_height[[2]])
lines(y2_seed, col=cols_height[[1]], lty=2)
lines(y2_adult, col=cols_height[[2]], lty=2)
legend("bottomright", c("Seedling", "Adult"), lty=1, col=cols_height, bty="n")
```

Note that the traits with the lowest growth rate in most lights
while a seedling (dotted lines) has the highest growth rate in all
lights as an adult.

-->
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daniel Falster, Richard FitzJohn, Rafael Schouten, Andrew O'Reilly-Nugent.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
