<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modelling the demography of plants, patches, and metacommunities • plant</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">plant</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../articles/plant.html">
    <span class="fa fa-tree"></span>
     
    Getting Started
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-list"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Theory
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/demography.html">Demography of plants, patches, and metacommunities</a>
    </li>
    <li>
      <a href="../articles/physiology.html">The FF16 strategy</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file-code-o"></span>
     
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/individuals.html">Individual plants</a>
    </li>
    <li>
      <a href="../articles/patch.html">Patches of competing plants</a>
    </li>
    <li>
      <a href="../articles/equilibrium.html">Finding demographic equilibrium</a>
    </li>
    <li>
      <a href="../articles/emergent.html">Emergent properties of patches</a>
    </li>
    <li>
      <a href="../articles/fitness.html">Calculating fitness</a>
    </li>
    <li>
      <a href="../articles/cohort_spacing.html">The cohort spacing algorithm</a>
    </li>
    <li>
      <a href="../articles/parameters.html">Changing parameters</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/developer_notes.html">
    <span class="fa fa-terminal"></span>
     
    Developer Notes
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/traitecoevo/plant">
    <span class="fa fa-github fa-lg"></span>
     
    Github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Modelling the demography of plants, patches, and metacommunities</h1>
                        <h4 class="author">Daniel Falster</h4>
                        <h4 class="author">Ake Brannstrom</h4>
                        <h4 class="author">Ulf Dieckmann</h4>
            
            <h4 class="date">2016</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This document outlines methods used to model demography in the <code>plant</code> package. We first outline the system of equations being solved. These equations were primarily developed elsewhere, in particular in <span class="citation">Falster, Brännström, Dieckmann, &amp; Westoby (2011)</span> and <span class="citation">Falster, Brännström, Westoby, &amp; Dieckmann (2015)</span>, following general principles laid out in <span class="citation">De Roos, Taljapurkar, &amp; Caswell (1997)</span>, <span class="citation">Kohyama (1993)</span>, and <span class="citation">Moorcroft, Hurtt, &amp; Pacala (2001)</span>. They are presented here so that users can understand the full system of equations being solved within <code>plant</code>. We then describe the numerical techniques used to solve the equations. Table <a href="#tab:definitions">1</a> provides a list of names and definitions used throughout this document.</p>
<table class="table">
<caption>
<span id="tab:definitions">Table 1: </span>Variable names and definitions in the demographic model of the <code>plant</code> package.</caption>
<thead><tr class="header">
<th align="left">Symbol</th>
<th align="left">Unit</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Patch state variables</strong></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(K\)</span></td>
<td align="left"></td>
<td align="left">Number of species in the metacommunity</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(a, a^{\prime}\)</span></td>
<td align="left">yr</td>
<td align="left">Patch age (time since disturbance)</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(a_0\)</span></td>
<td align="left">yr</td>
<td align="left">Patch age when plant germinates</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(E_a\)</span></td>
<td align="left"></td>
<td align="left">Profile of canopy openness within a patch of age <span class="math inline">\(a\)</span>
</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(E_a(z)\)</span></td>
<td align="left"></td>
<td align="left">Canopy openness at height <span class="math inline">\(z\)</span> within a patch of age <span class="math inline">\(a\)</span>
</td>
</tr>
<tr class="odd">
<td align="left"><strong>Plant state variables</strong></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(x\)</span></td>
<td align="left"></td>
<td align="left">Vector of traits for a species</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(H\)</span></td>
<td align="left">m</td>
<td align="left">Height of a plant</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(H_0(x)\)</span></td>
<td align="left">m</td>
<td align="left">Height of a seedling with traits <span class="math inline">\(x\)</span> after germination</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(z\)</span></td>
<td align="left">m</td>
<td align="left">Height in canopy</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(A_{\rm l}(H)\)</span></td>
<td align="left">m<span class="math inline">\(^2\)</span>
</td>
<td align="left">Leaf area of a plant with height <span class="math inline">\(H\)</span>
</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(Q(z, H)\)</span></td>
<td align="left"></td>
<td align="left">Fraction of leaf area above height <span class="math inline">\(z\)</span> for a plant with height <span class="math inline">\(H\)</span>
</td>
</tr>
<tr class="even">
<td align="left"><strong>Abundance measures</strong></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(P(a)\)</span></td>
<td align="left">yr<span class="math inline">\(^{-1}\)</span>
</td>
<td align="left">Frequency-density of patches of age <span class="math inline">\(a\)</span>
</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(Y_{x}\)</span></td>
<td align="left">m<span class="math inline">\(^{-2}\)</span> yr<span class="math inline">\(^{-1}\)</span>
</td>
<td align="left">Global seed rain for a species with traits <span class="math inline">\(x\)</span>
</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(N(H | x, a)\)</span></td>
<td align="left">m<span class="math inline">\(^{-1}\)</span> m<span class="math inline">\(^{-2}\)</span>
</td>
<td align="left">Density of plants at height <span class="math inline">\(H\)</span> per unit ground area for given traits <span class="math inline">\(x\)</span> and patch age <span class="math inline">\(a\)</span>
</td>
</tr>
<tr class="even">
<td align="left"><strong>Demographic rates</strong></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(g(x, H, E_a)\)</span></td>
<td align="left">m yr<span class="math inline">\(^{-1}\)</span>
</td>
<td align="left">Height growth rate of a plant with traits <span class="math inline">\(x\)</span> and height <span class="math inline">\(H\)</span> in the light environment <span class="math inline">\(E_a\)</span> in a patch of age <span class="math inline">\(a\)</span>
</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(f(x, H, E_a)\)</span></td>
<td align="left">yr<span class="math inline">\(^{-1}\)</span>
</td>
<td align="left">Seed production rate of a plant with traits <span class="math inline">\(x\)</span> and height <span class="math inline">\(H\)</span> in the light environment <span class="math inline">\(E_a\)</span> in a patch of age <span class="math inline">\(a\)</span>
</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(d(x, H, E_a)\)</span></td>
<td align="left">yr<span class="math inline">\(^{-1}\)</span>
</td>
<td align="left">Instantaneous mortality rate of a plant with traits <span class="math inline">\(x\)</span> and height <span class="math inline">\(H\)</span> in the light environment <span class="math inline">\(E_a\)</span> in a patch of age <span class="math inline">\(a\)</span>
</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(d_{\rm P}(a)\)</span></td>
<td align="left">yr<span class="math inline">\(^{-1}\)</span>
</td>
<td align="left">Instantaneous disturbance rate of a patch of age <span class="math inline">\(a\)</span>
</td>
</tr>
<tr class="odd">
<td align="left"><strong>Demographic outcomes</strong></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(H(x, a_0, a)\)</span></td>
<td align="left">m</td>
<td align="left">Height of a plant with traits <span class="math inline">\(x\)</span> in a patch of age <span class="math inline">\(a\)</span> having germinated at patch age <span class="math inline">\(a_0\)</span>
</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(S_{\rm D}\)</span></td>
<td align="left"></td>
<td align="left">Probability a seed survives dispersal</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(S_{\rm G} (x, H_0, E_{{\rm a}0})\)</span></td>
<td align="left"></td>
<td align="left">Probability the seed of a plant with traits <span class="math inline">\(x\)</span> germinates successfully at height <span class="math inline">\(H_0\)</span> in the light environment <span class="math inline">\(E_{{\rm a}0}\)</span> in a patch of age <span class="math inline">\(a_0\)</span>
</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(S_{\rm I} (x, a_0, a)\)</span></td>
<td align="left"></td>
<td align="left">Probability a plant survives from patch age <span class="math inline">\(a_0\)</span> to patch age <span class="math inline">\(a\)</span>
</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(S_{\rm P} ( a_0, a)\)</span></td>
<td align="left"></td>
<td align="left">Probability a patch remains undisturbed from patch age <span class="math inline">\(a_0\)</span> to patch age <span class="math inline">\(a\)</span>
</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(\tilde{R}(x, a_0, a)\)</span></td>
<td align="left"></td>
<td align="left">Cumulative seed output for plants with traits <span class="math inline">\(x\)</span> from patch age <span class="math inline">\(a_0\)</span> to patch age <span class="math inline">\(a\)</span>
</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(R\left(x^\prime, x\right)\)</span></td>
<td align="left"></td>
<td align="left">Basic reproduction ratio for a mutant plant with traits <span class="math inline">\(x^\prime\)</span> growing in a metapopulation of resident plants with traits <span class="math inline">\(x\)</span>
</td>
</tr>
<tr class="odd">
<td align="left"><strong>Miscellaneous constants</strong></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(k_{\rm I}\)</span></td>
<td align="left"></td>
<td align="left">Light extinction coefficient</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(\bar{a}\)</span></td>
<td align="left">yr</td>
<td align="left">Mean interval between patch disturbances</td>
</tr>
</tbody>
</table>
</div>
<div id="system-dynamics" class="section level1">
<h1 class="hasAnchor">
<a href="#system-dynamics" class="anchor"></a>Metacommunity dynamics</h1>
<p>The following material is written assuming there exists a physiological sub-model that takes as inputs a plant’s traits <span class="math inline">\(x\)</span>, height <span class="math inline">\(H\)</span>, and light environment <span class="math inline">\(E_a\)</span>, and returns rates of growth, mortality, and fecundity. The physiological model must describe how much leaf area the plant contributes to shading other plants in the patch. Specifically, the physiological model is responsible for calculating the following variables from Table <a href="#tab:definitions">1</a>: <span class="math inline">\(A_{\rm l}(H)\)</span>, <span class="math inline">\(Q(z, H)\)</span>, <span class="math inline">\(H_0(x)\)</span>, <span class="math inline">\(g(x, H, E_a)\)</span>, <span class="math inline">\(f(x, H, E_a)\)</span>, <span class="math inline">\(d(x, H, E_a)\)</span>, and <span class="math inline">\(S_{\rm G} (x, H_0, E_{{\rm a}0})\)</span>. All are other variables in Table <a href="#tab:definitions">1</a> are calculated in the demographic model using the equations provided below.</p>
<div id="individual-plants" class="section level2">
<h2 class="hasAnchor">
<a href="#individual-plants" class="anchor"></a>Individual plants</h2>
We first consider the dynamics of an individual plant. Throughout, we refer to a plant as having traits <span class="math inline">\(x\)</span> and size <span class="math inline">\(H\)</span>, with the latter given by its height. The plant grows in a light environment <span class="math inline">\(E\)</span>, a function describing the distribution of light with respect to height within a patch. Ultimately, <span class="math inline">\(E\)</span> depends on the composition of plants in a patch, and thus on the patch age <span class="math inline">\(a\)</span>. To indicate this dependence, we write <span class="math inline">\(E_a\)</span>. Further, let <span class="math inline">\(a_0\)</span>be the age in which the plant germinated, and <span class="math inline">\(H_0(x)\)</span> its initial height. The functions <span class="math inline">\(g(x, H, E_a)\)</span>, <span class="math inline">\(f(x, H, E_a)\)</span>, and <span class="math inline">\(d(x, H, E_a)\)</span> denote the growth, death, and fecundity rates of the plant. Then,
<span class="math display" id="eq:size">\[\begin{equation}
H(x, a_0, a) = H_0(x) + \int_{a_0}^{a} g(x, H(x, a_0, a^\prime), E_{a^\prime}) \, {\rm d}a^\prime
\tag{1}
\end{equation}\]</span>
is the trajectory of plant height,
<span class="math display" id="eq:survivalIndividual">\[\begin{equation}
S_{\rm I} (x, a_0, a) = S_{\rm G} (x, H_0, E_{{\rm a}0}) \, \exp\left(- \int_{a_0}^{a} d(x, H(x, a_0, a^\prime), E_{a^\prime}) \, {\rm d} a^\prime \right)
\tag{2}
\end{equation}\]</span>
is the probability of plant survival within the patch, where <span class="math inline">\(S_{\rm G} (x, H_0, E_{{\rm a}0})\)</span> is the probability a seed germinates successfully, and
<span class="math display" id="eq:tildeR1">\[\begin{equation}
\tilde{R}(x, a_0, a) = \int_{a_0}^{a} f(x, H(x, a_0, a^\prime), E_{a^\prime}) \, S_{\rm I} (x, a_0, a^\prime) \, {\rm d} a^\prime
\tag{3}
\end{equation}\]</span>
<p>is the plant’s cumulative seed output, from its birth at patch age <span class="math inline">\(a = a_0\)</span> until patch age <span class="math inline">\(a\)</span>.</p>
<p>The notational complexity required in Eqs. <a href="#eq:size">(1)</a>-<a href="#eq:tildeR1">(3)</a> potentially obscures an important point: these equations are simply the general, non-linear solutions to integrating growth, mortality, and fecundity over time.</p>
</div>
<div id="patches-of-competing-plants-size-structured-populations" class="section level2">
<h2 class="hasAnchor">
<a href="#patches-of-competing-plants-size-structured-populations" class="anchor"></a>Patches of competing plants</h2>
<p>We now consider a patch of competing plants. At any age <span class="math inline">\(a\)</span>, the patch is described by the size-density distribution <span class="math inline">\(N(H | x, a)\)</span> of plants with traits <span class="math inline">\(x\)</span> and height <span class="math inline">\(H\)</span>. In a finite-sized patch, <span class="math inline">\(N\)</span> is described by a collection of points, each indicating the height of one individual, whereas in a very (infinitely) large patch, <span class="math inline">\(N\)</span> is a continuous function. In either case, the demographic behaviour of the plants within the patch is given by Eqs. <a href="#eq:size">(1)</a>-<a href="#eq:tildeR1">(3)</a>. Integrating the dynamics over time is complicated by- two other factors: (i) plants interact, thereby altering <span class="math inline">\(E_a\)</span> with age, and (ii) new individuals may establish, expanding the system of equations.</p>
In the current version of <code>plant</code>, plants interact by shading one another. Following standards biophysical principles, we let the canopy openness <span class="math inline">\(E_a(z)\)</span> at height <span class="math inline">\(z\)</span> in a patch of age <span class="math inline">\(a\)</span> decline exponentially with the total amount of leaf area above <span class="math inline">\(z\)</span>,
<span class="math display" id="eq:light">\[\begin{equation}
E_a(z) = \exp \left(-k_{\rm I} \sum_{i = 1}^{K} \int_{0}^{\infty} A_{\rm l}(H) \, Q(z, H) \, N(H | x_i, a) \, {\rm d}H \right),
\tag{4}
\end{equation}\]</span>
<p>where <span class="math inline">\(A_{\rm l}(H)\)</span> is the total leaf area of a plant with height <span class="math inline">\(H\)</span>, <span class="math inline">\(Q(z, H)\)</span> is the fraction of this leaf area situated above height <span class="math inline">\(z\)</span> for plants of height <span class="math inline">\(H\)</span>, <span class="math inline">\(k_{\rm I}\)</span> is the light extinction coefficient, and <span class="math inline">\(K\)</span> is the number of species in the metacommunity.</p>
Assuming patches are sufficiently large, the dynamics of <span class="math inline">\(N\)</span> can be modelled deterministically via the following partial differential equation (PDE) <span class="citation">(Kohyama, 1993, <span class="citation">De Roos et al. (1997)</span>, <span class="citation">Moorcroft et al. (2001)</span>)</span>,
<span class="math display" id="eq:PDE">\[\begin{equation}
\frac{\partial}{\partial a} N(H | x, a) = - d(x, H, E_a) \, N(H | x, a) - \frac{\partial}{\partial H} \left[g(x, H, E_a) \, N(H | x, a)\right].
\tag{5}
\end{equation}\]</span>
<p>See section <a href="#derivation-of-pde-describing-size-structured-dynamics">derivation-of-pde-describing-size-structured-dynamics</a> for the derivation of this PDE.</p>
Eq. <a href="#eq:PDE">(5)</a> has two boundary conditions. The first links the flux of individuals across the lower bound <span class="math inline">\((H_0(x))\)</span> of the size-density distribution to the rate <span class="math inline">\(Y_{x}\)</span> at which seeds arrive in the patch,
<span class="math display" id="eq:BC1">\[\begin{equation}
N(H_0 | x, a_0) = \left\{
\begin{array}{ll} \frac{Y_{x} \, S_{\rm G} (x, H_0, E_{{\rm a}0}) }{ g(x, H_0, E_{{\rm a}0}) } &amp; \textrm{if } g(x, H_0, E_{{\rm a}0}) &gt; 0 \\
0 &amp; \textrm{otherwise.}
\end{array} \right.
\tag{6}
\end{equation}\]</span>
<p>The function <span class="math inline">\(S_{\rm G} (x, H_0, E_{{\rm a}0})\)</span> denotes survival through germination and must be chosen such that <span class="math inline">\(S_{\rm G} (x, H_0, E_{{\rm a}0}) / g(x, H_0, E_{{\rm a}0}) \rightarrow 0\)</span> as <span class="math inline">\(g(x, H_0, E_{{\rm a}0}) \rightarrow 0\)</span>, to ensure a smooth decline in initial density as conditions deteriorate <span class="citation">(Falster et al., 2011)</span>.</p>
The second boundary condition of Eq. <a href="#eq:PDE">(5)</a> specifies the initial size-density distribution in patches right after a disturbance, i.e., for <span class="math inline">\(a = 0\)</span>. Throughout, we consider only situations starting with an empty patch,
<span class="math display" id="eq:BC2">\[\begin{equation}
N\left(H|x,0\right) = 0,
\tag{7}
\end{equation}\]</span>
<p>although non–zero distributions could alternatively be specified <span class="citation">(e.g. Kohyama, 1993, <span class="citation">Moorcroft et al. (2001)</span>)</span>.</p>
</div>
<div id="age-structured-distribution-of-patches" class="section level2">
<h2 class="hasAnchor">
<a href="#age-structured-distribution-of-patches" class="anchor"></a>Age structure of patches</h2>
We now consider the distribution of patch age <span class="math inline">\(a\)</span> in the metacommunity. With <span class="math inline">\(a\)</span> denoting the time since last disturbance, <span class="math inline">\(P(a)\)</span> denotes the frequency-density of patch age <span class="math inline">\(a\)</span> and <span class="math inline">\(d_{\rm P}(a)\)</span> is the age-dependent probability that a patch of age <span class="math inline">\(a\)</span> is transformed into a patch of age 0 by a disturbance event. Here we focus on situations where the age structure has reached an equilibrium. See section <a href="#derivation-of-pde-describing-age-structured-dynamics">derivation-of-pde-describing-age-structured-dynamics</a> for the derivation and non-equilibrium situations. The dynamics of <span class="math inline">\(P\)</span> are given by <span class="citation">(McKendrick, 1926, <span class="citation">Foerster (1959)</span>)</span>
<span class="math display" id="eq:agepde">\[\begin{equation}
\frac{{\rm d}}{{\rm d} a} P(a) = - d_{\rm P}(a) \, P(a) ,
\tag{8}
\end{equation}\]</span>
with the boundary condition
<span class="math display" id="eq:agepd2">\[\begin{equation}
P(0) = \int_0^\infty d_{\rm P}(a) \, P(a) \, {\rm d} a.
\tag{9}
\end{equation}\]</span>
The probability that a patch remains undisturbed from patch age <span class="math inline">\(a_0\)</span> to patch age <span class="math inline">\(a\)</span> is then given by
<span class="math display" id="eq:survivalPatch">\[\begin{equation}
S_{\rm P} (a_0, a) = \exp\left( - \int_{a_0}^{a} d_{\rm P}(a^\prime) \, {\rm d} a^\prime \right).
\tag{10}
\end{equation}\]</span>
These equations lead to an equilibrium distribution of patch ages,
<span class="math display" id="eq:agepde3">\[\begin{equation}
P(a) = P(0) S_{\rm P} (0, a),
\tag{11}
\end{equation}\]</span>
where
<span class="math display" id="eq:agepde4">\[\begin{equation}
P(0) = \frac1{\int_0^\infty S_{\rm P} (0, a) {\rm d}a}
\tag{12}
\end{equation}\]</span>
<p>is the average disturbance frequency of a patch and, at the same time, the frequency-density of patches of age <span class="math inline">\(0\)</span>.</p>
<p>The default approach in <code>plant</code> is to assume that <span class="math inline">\(d_{\rm P}(a)\)</span> increases linearly with patch age, which leads to a Weibull distribution for <span class="math inline">\(P\)</span>, specified by a single parameter <span class="math inline">\(\bar{a}\)</span> measuring the mean interval between disturbances (see section <a href="#derivation-of-pde-describing-age-structured-dynamics">derivation-of-pde-describing-age-structured-dynamics</a> for details).</p>
</div>
<div id="trait--size--and-patch-structured-metapopulations" class="section level2">
<h2 class="hasAnchor">
<a href="#trait--size--and-patch-structured-metapopulations" class="anchor"></a>Trait-, size-, and patch-structured metacommunities</h2>
<p>We consider a large area of habitat where: (i) disturbances (such as fires, storms, landslides, floods, or disease outbreaks) strike patches of the habitat on a stochastic basis, killing all individuals within the affected patches; (ii) individuals compete for resources within patches, with a spatial scale of competitive interactions that renders negligible such interactions between individuals in adjacent patches; and (iii) there is high connectivity via dispersal between all patches in the habitat, allowing empty patches to be quickly re-colonised. Such a system can be modelled as a metapopulation (for a single species) or metacommunity (for multiple species). The dynamics of such a metacommunity are described by the PDEs in Eqs. <a href="#eq:PDE">(5)</a>-<a href="#eq:agepde4">(12)</a>.</p>
The seed rain of each species in the metacommunity is given by the rate at which seeds are produced across all patches,
<span class="math display" id="eq:seed-rain">\[\begin{equation}
Y_x  = \int_0^{\infty} \int_0^{\infty} P(a) \, S_{\rm D} \, f(x, H, E_a) \, N(H | x, a) \, {\rm d} H \, {\rm d} a,
\tag{13}
\end{equation}\]</span>
<p>where <span class="math inline">\(S_{\rm D}\)</span> is the survival probability of seeds during dispersal.</p>
<p>A convenient feature of Eqs. <a href="#eq:PDE">(5)</a> - <a href="#eq:agepde4">(12)</a> is that the dynamics of a single patch scale up to give the dynamics of the entire metacommunity. Note that the rate <span class="math inline">\(Y_x\)</span> at which offspring of individuals with traits <span class="math inline">\(x\)</span> arrive from the disperser pool is constant when the metacommunity is at equilibrium. Combined with the assumption that all patches have the same initial (empty) size-density distribution after a disturbance, the assumption of constant seed rains ensures that all patches show the same temporal behaviour, the only difference between them being their ages.</p>
<p>To model the temporal dynamics of an archetypal patch, we need only a value for <span class="math inline">\(Y_x\)</span>. The numerical challenge is therefore to find the right value for <span class="math inline">\(Y_x\)</span>, by solving Eqs. <a href="#eq:BC1">(6)</a>-<a href="#eq:seed-rain">(13)</a> simultaneously, for all species with traits <span class="math inline">\(x\)</span> in the metacommunity.</p>
</div>
<div id="emergent-properties-of-metapopulation" class="section level2">
<h2 class="hasAnchor">
<a href="#emergent-properties-of-metapopulation" class="anchor"></a>Emergent properties of metacommunities</h2>
Summary statistics of a metacommunity are obtained by integrating over the size-density distribution, weighting by the frequency-density <span class="math inline">\(P(a)\)</span>. In particular, the average density of individuals per unit ground area across the metacommunity is
<span class="math display" id="eq:Nav">\[\begin{equation}
\hat{N}(x) = \int_{0}^{\infty} \int_{0}^{\infty} P(a) \, N(H | x, a) \, {\rm d}a \, {\rm d}H,
\tag{14}
\end{equation}\]</span>
and the average size-density of plants with height <span class="math inline">\(H\)</span> is
<span class="math display" id="eq:NDav">\[\begin{equation}
\bar{N}(x, H) = \int_{0}^{\infty}P(a) \, N(H | x, a) \, {\rm d}a.
\tag{15}
\end{equation}\]</span>
Averages for other individual-level quantities can also be calculated. Denoting by <span class="math inline">\(w(x, H, E_a)\)</span> a quantity of interest, either a demographic rate (growth, mortality) or a state (plant height, leaf area, light environment), the average of <span class="math inline">\(w\)</span> for plants with height <span class="math inline">\(H\)</span> and traits <span class="math inline">\(x\)</span> is
<span class="math display" id="eq:Wav1">\[\begin{equation}\bar{w}(x, H) = \frac1{\bar{N}(x, H)}\int_{0}^{\infty}P(a) \, N(H | x, a) \, w(x, H, E_a) \, {\rm d}a.
\tag{16}
\end{equation}\]</span>
The average of <span class="math inline">\(w\)</span> across all individuals of the species is
<span class="math display" id="eq:Wav2">\[\begin{equation}
\hat{w}(x) = \frac1{\hat{N}(x) }\int_{0}^{\infty} \int_{0}^{\infty}P(a) \, N(H | x, a) \, w(x, H, E_a) \, {\rm d}a \, {\rm d}H.
\tag{17}
\end{equation}\]</span>
<p>When calculating the average mortality rate, one must decide whether mortality due to patch disturbance is included. Non-disturbance mortality is obtained by setting <span class="math inline">\(w(x, H, E_a) = d(x, H, E_a)\)</span>, while the total mortality due to growth processes and disturbance is obtained by setting <span class="math inline">\(w(x, H, E_a) = d(x, H, E_a) + d_{\rm P}(a) S_{\rm P}(0, a).\)</span></p>
Similarly, we can integrate over the size-density distribution to extract aggregate features of the vegetation within a patch,
<span class="math display" id="eq:Wa-a">\[\begin{equation}
W(a) = \sum_{i = 1}^{N} \int_{0}^{\infty} N(H | x_i, a)\, w(x_i, H, E_a) \, {\rm d}H,
\tag{18}
\end{equation}\]</span>
and across the entire metacommunity,
<span class="math display" id="eq:Wa-b">\[\begin{equation}
\hat{W} = \int_{0}^{\infty} P(a) \, W(a) \, {\rm d}a.
\tag{19}
\end{equation}\]</span>
</div>
<div id="invasion-fitness" class="section level2">
<h2 class="hasAnchor">
<a href="#invasion-fitness" class="anchor"></a>Invasion fitness</h2>
<p>We now consider how to estimate the fitness of a rare mutant individual with traits <span class="math inline">\(x^\prime\)</span> growing in the light environment of a resident community with traits <span class="math inline">\(x\)</span>. We focus on phenotype-dependent components of fitness – describing the aggregate consequences of a given set of traits for growth, fecundity, and mortality – taking into account the non-linear effects of competition, but ignoring the underlying genetic basis for trait inheritance and expression. We also adhere to standard conventions in such analyses by assuming that the mutant phenotype is sufficiently rare to have a negligible effect on the light environment where it is growing <span class="citation">(Geritz, Kisdi, Meszéna, &amp; Metz, 1998)</span>. The approach for calculating fitness implemented here follows the approach described by <span class="citation">Falster et al. (2015)</span>.</p>
<p>In general, invasion fitness is defined as the long-term per capita growth rate of a rare mutant phenotype in the environment determined by a resident phenotype <span class="citation">(Metz, Nisbet, &amp; Geritz, 1992)</span>. Calculating per capita growth rates, however, is particularly challenging in a structured metacommunity model <span class="citation">(Gyllenberg &amp; Metz, 2001, <span class="citation">Metz &amp; Gyllenberg (2001)</span>)</span>. As an alternative measure of invasion fitness in metacommunities, we can use the basic reproduction ratio measuring the expected number of new dispersers arising from a single dispersal event. For metacommunities at demographic equilibrium, evolutionary inferences made using basic reproduction ratios are equivalent to those made using per capita growth rates <span class="citation">(Gyllenberg &amp; Metz, 2001, <span class="citation">Metz &amp; Gyllenberg (2001)</span>)</span>.</p>
We denote by <span class="math inline">\(R\left(x^\prime, x\right)\)</span> the basic reproduction ratio of individuals with traits <span class="math inline">\(x^\prime\)</span> growing in the competitive light environment of the resident traits <span class="math inline">\(x\)</span>. Recalling that patches of age <span class="math inline">\(a\)</span> have frequency-density <span class="math inline">\(P(a)\)</span> in the landscape, it follows that any seed with traits <span class="math inline">\(x^\prime\)</span> has a probability of <span class="math inline">\(P(a)\)</span> of landing in a patch of age <span class="math inline">\(a\)</span>. The basic reproduction ratio for individuals with traits <span class="math inline">\(x^\prime\)</span> is then
<span class="math display" id="eq:InvFit">\[\begin{equation}
R\left(x^\prime,x\right) = \int _0^{\infty} P\left(a\right) \, \tilde{R}\left(x^\prime, a, \infty \right) \, {\rm d}a ,
\tag{20}
\end{equation}\]</span>
where <span class="math inline">\(\tilde{R}\left(x^\prime, a_0, a \right)\)</span> is the expected number of dispersing offspring produced by a single dispersing seed with traits <span class="math inline">\(x^\prime\)</span> arriving in a patch of age <span class="math inline">\(a_0\)</span> up until age <span class="math inline">\(a\)</span> <span class="citation">(Gyllenberg &amp; Metz, 2001, <span class="citation">Metz &amp; Gyllenberg (2001)</span>)</span>. In turn, <span class="math inline">\(\tilde{R}\left(x^\prime, a,\infty\right)\)</span> is calculated by integrating an individual’s fecundity over the expected lifetime of a patch, taking into account competitive shading from residents with traits <span class="math inline">\(x\)</span>, the individual’s probability of surviving, and its traits,
<span class="math display" id="eq:tildeR">\[\begin{equation}
\tilde{R}(x^\prime, a_0, \infty) = \int_{a_0}^{\infty} S_{\rm D} \, f(x^\prime, H(x^\prime, a_0, a), E_{a}) \, S_{\rm I} (x^\prime, a_0, a) \, S_{\rm P} (a_0, a) \, {\rm d} a.
\tag{21}
\end{equation}\]</span>
</div>
</div>
<div id="numerical-methods-for-solving-metacommunity-dynamics" class="section level1">
<h1 class="hasAnchor">
<a href="#numerical-methods-for-solving-metacommunity-dynamics" class="anchor"></a>Numerical methods for solving metacommunity dynamics</h1>
<p>The equations below describe how we solve the trait-, size-, and patch-structured population dynamics specified in the previous section. Our approach to solving for the size-density distribution is based on the characteristic method <span class="citation">(Angulo &amp; López-Marcos, 2004, <span class="citation">Angulo, López-Marcos, &amp; López-Marcos (2014)</span>, <span class="citation">Angulo, López-Marcos, &amp; López-Marcos (2016)</span>)</span>. The characteristic method is related to the Escalator Boxcar Train technique <span class="citation">(De Roos, 1988, <span class="citation">De Roos et al. (1997)</span>, <span class="citation">De Roos, Diekmann, &amp; Metz (1992)</span>)</span>, but not identical to it.</p>
<p>When simulating an individual plant, or the development of a patch, we need to solve for the size, survival, and seed output of individual plants. When solving for the size-density distribution in a large patch, we also need to estimate the average abundance of individuals. Each of these problems is formulated as an initial-value ODE problem (IVP), which can be solved using an ODE stepper.</p>
<div id="approach" class="section level2">
<h2 class="hasAnchor">
<a href="#approach" class="anchor"></a>Approach</h2>
<div id="size" class="section level3">
<h3 class="hasAnchor">
<a href="#size" class="anchor"></a>Size</h3>
The size of an individual is obtained via Eq. <a href="#eq:size">(1)</a> which is solved via the IVP
<span class="math display" id="eq:size-y">\[\begin{equation}
\frac{dy}{dt} = g(x, y, t) ,
\tag{22}
\end{equation}\]</span>
<span class="math display" id="eq:size-y0">\[\begin{equation}
 y(0) = H_0(x).
\tag{23}
\end{equation}\]</span>
</div>
<div id="survival" class="section level3">
<h3 class="hasAnchor">
<a href="#survival" class="anchor"></a>Survival</h3>
The probability of an individual surviving from patch age <span class="math inline">\(a_0\)</span> to patch age <span class="math inline">\(a\)</span> is obtained via Eq. <a href="#eq:survivalIndividual">(2)</a>, which is solved via the IVP
<span class="math display" id="eq:surv-y">\[\begin{equation}
\frac{dy}{dt} = d(x, H_i(t) , E_t),
\tag{24}
\end{equation}\]</span>
<span class="math display" id="eq:surv-y0">\[\begin{equation}
 y(0) = - \ln\left(S_{\rm G} (x, H_0, E_{a0})\right) .
\tag{25}
\end{equation}\]</span>
Survival is then
<span class="math display" id="eq:surv-SI">\[\begin{equation}
 S_{\rm I} (x, a_0, a) = \exp\left( - y(a) \right).
\tag{26}
\end{equation}\]</span>
</div>
<div id="seed-production" class="section level3">
<h3 class="hasAnchor">
<a href="#seed-production" class="anchor"></a>Seed production</h3>
The lifetime seed production of individuals is obtained via Eq. <a href="#eq:tildeR1">(3)</a>, which is solved via the IVP
<span class="math display" id="eq:dy">\[\begin{equation}
\frac{dy}{dt} = S_{\rm D} \, f(x, H_i(t), E_t) \, S_{\rm I} (x, a_0,t) \, S_{\rm P} (a_0, t),
\tag{27}
\end{equation}\]</span>
<span class="math display" id="eq:y0">\[\begin{equation}
 y(0) = 0,
\tag{28}
\end{equation}\]</span>
<p>where <span class="math inline">\(S_{\rm I}\)</span> is calculated as described above and <span class="math inline">\(S_{\rm P}\)</span> is calculated as in Eq. <a href="#eq:survivalPatch">(10)</a>$.</p>
</div>
<div id="density-of-individuals" class="section level3">
<h3 class="hasAnchor">
<a href="#density-of-individuals" class="anchor"></a>Size-density of individuals</h3>
By integrating along the characteristics of Eq. <a href="#eq:PDE">(5)</a>, the size-density of individuals born with height <span class="math inline">\(H_0\)</span> and traits <span class="math inline">\(x\)</span> at patch age <span class="math inline">\(a_{0}\)</span> is given by <span class="citation">(De Roos et al., 1997, <span class="citation">Angulo &amp; López-Marcos (2004)</span>)</span>
<span class="math display" id="eq:boundN">\[\begin{equation}
N(H | x, a) = N(H_0 | x, a_0)
\exp \left( - \int _{a_0}^{a} \left[\frac{\partial g(x, H(x, a_0, a^\prime), E_{a^\prime})}{\partial H} + d(x, H(x, a_0, a^\prime), E_{a^\prime})\right] {\rm d} a^\prime \right).
\tag{29}
\end{equation}\]</span>
<p>Eq. <a href="#eq:boundN">(29)</a> states that the size-density <span class="math inline">\(N\)</span> at a specific patch age <span class="math inline">\(a\)</span> is the product of the size-density at patch age <span class="math inline">\(a_{0}\)</span> adjusted for changes through growth and mortality. Size-density decreases through time because of mortality, as in a typical survival equation, but also changes because of growth. If growth is slowing with size, (i.e., <span class="math inline">\(\partial g / \partial H &lt; 0\)</span>), size-density will increase since the characteristics compress. Conversely, size-density will increases if <span class="math inline">\(\partial g / \partial H &gt; 0\)</span>.</p>
<p>Denoting by <span class="math inline">\(\left[H_0, H_{ + } \right)\)</span> the range of heights attainable by any individual, our algorithm for solving metacommunity dynamics proceeds by sub-dividing this interval into a series of cohorts with heights <span class="math inline">\(H_0 &lt; H_1 &lt; \ldots &lt; H_k\)</span> at the initial points of the characteristic curves. These cohorts are then transported along the characteristics of Eq. <a href="#eq:PDE">(5)</a>. The placement of cohorts is controlled indirectly, via the schedule of patch ages at which new cohorts are introduced into the metacommunity. We then track the demography of each such cohort.</p>
The integral in Eq. <a href="#eq:boundN">(29)</a> is solved via the IVP
<span class="math display" id="eq:dy-N">\[\begin{equation}
\frac{dy}{dt} = \frac{\partial g(x, H_i(t), E_t)}{\partial H} + d(x, H_i(t), E_t),
\tag{30}
\end{equation}\]</span>
<span class="math display" id="eq:y0-N">\[\begin{equation}
 y(0) = - \ln\left(N(H_0 | x, a_0) \, S_{\rm G} (x, H_0, E_{{\rm a}0}) \right),
\tag{31}
\end{equation}\]</span>
from which we obtain the size-density
<span class="math display" id="eq:N-H0">\[\begin{equation}
N(H_0 | x, a_0) = \exp( - y(a)).
\tag{32}
\end{equation}\]</span>
</div>
</div>
<div id="controls-on-approximation-error" class="section level2">
<h2 class="hasAnchor">
<a href="#controls-on-approximation-error" class="anchor"></a>Controls on approximation error</h2>
<p>We now outline how to control the error of the approximate solutions to the system of equations described above. In our algorithm, numerical solutions are required to address a variety of problems:</p>
<ul>
<li>To estimate the amount of light at a given height in a patch requires numerically integrating over the size-density distribution within that patch.</li>
<li>To calculate the assimilation of a plant requires numerically integrating photosynthesis over this light profile.</li>
<li>To simulate patch dynamics requires numerically identifying a vector of patch ages at which new cohorts are introduced, and then numerically stepping the equations for each cohort forward in time to estimate their size, survival, and fecundity at different subsequent patch ages.</li>
<li>To solve for the initial height of a plant given its seed mass, and for the equilibrium seed rains across the metacommunity, requires numerical root finding.</li>
</ul>
<p>As with all numerical techniques, solutions to each of these problems are accurate only up to a specified level. These levels are controlled via parameters in the <code>plant</code> code. Below, we provide a brief overview of the different numerical techniques being applied and outline how error tolerance can be increased or decreased. We refer to various control parameters that can be found within the <code>control</code> object. For a worked example illustrating how to modify these control parameters, see the section <code>parameters</code> of Appendix S3.</p>
<div id="initial-height-of-plants" class="section level3">
<h3 class="hasAnchor">
<a href="#initial-height-of-plants" class="anchor"></a>Initial plant heights</h3>
<p>When a seed germinates, it produces a seedling of given height. The height of these seedlings is assumed to vary with the seed mass. Because there is no analytical solution relating seedling height to seed mass – at least when using the default <code>FF16</code> physiological model – we must solve for this height numerically. The calculation is performed by the function <code>height_seed</code> within the physiological model, using the Boost library’s one-dimensional <code>bisect</code> routine <span class="citation">(Schäling, 2014, <span class="citation">Eddelbuettel, Emerson, &amp; Kane (2015)</span>)</span>. The accuracy of the solution is controlled by the parameter <code>plant_seed_tol</code>.</p>
</div>
<div id="stepping-of-odes" class="section level3">
<h3 class="hasAnchor">
<a href="#stepping-of-odes" class="anchor"></a>Stepping of ODEs</h3>
<p>All of the IVPs outlined above (in section <a href="#approach">approach</a>) must be stepped through time. For this, <code>plant</code> uses the embedded Runge-Kutta Cash-Karp 4-5 algorithm <span class="citation">(Cash &amp; Karp, 1990)</span>, with code ported directly from the <a href="http://www.gnu.org/software/gsl/">GNU Scientific Library</a> <span class="citation">(Galassi, 2009)</span>. The accuracy of the solver is controlled by two control parameters for relative and absolute accuracy, <code>ode_tol_rel</code> and <code>ode_tol_abs</code>.</p>
</div>
<div id="approximation-of-size-density-distribution-via-the-ebt" class="section level3">
<h3 class="hasAnchor">
<a href="#approximation-of-size-density-distribution-via-the-ebt" class="anchor"></a>Approximation of size-density distribution via the characteristic method</h3>
<p>Errors in the approximation of the size-density distribution arise from two sources: (i) coarse stepping of cohorts through time and (ii) poor spacing of cohorts across the attainable size range.</p>
<p>As described above, the stepping of the ODE solver is controlled by two control parameters for relative and absolute accuracy, <code>ode_tol_rel</code> and <code>ode_tol_abs</code>.</p>
<p>A second factor controlling the accuracy with which cohorts are stepped through time is the accuracy of the derivative calculation according to Eq. <a href="#eq:boundN">(29)</a>, calculated via standard finite differencing <span class="citation">(Abramowitz &amp; Stegun, 2012)</span>. When the parameter <code>cohort_gradient_richardson</code> is <code>TRUE</code> a Richardson extrapolation <span class="citation">(Stoer &amp; Bulirsch, 2002)</span> is used to refine the estimate, up to depth <code>cohort_gradient_richardson</code>. The overall accuracy of the derivative is controlled by <code>cohort_gradient_eps</code>.</p>
<p>The primary factor controlling the spacing of cohorts is the schedule of cohort introduction times. Because the system of equations to be integrated is deterministic, the schedule of cohort introduction times determines the spacing of cohorts throughout the entire development of a patch. Poor cohort spacing introduces error because various emergent properties – such as total leaf area, biomass, or seed output – are estimated by integrating over the size-density distribution. The accuracy of these integrations declines directly with the inappropriate spacing of cohorts. Thus, our algorithm aims to build an appropriately refined schedule, which allows the required integrations to be performed with the desired accuracy at every time point. At the same time, for reasons of computational efficiency, we want as few cohorts as possible.</p>
<p>A suitable schedule is found using the function <code>build_schedule</code>. This function takes an initial vector of introduction times and considers for each cohort whether removing that cohort causes the error introduced when integrating two specified functions over the size-density distribution to jump over the allowable error threshold <code>schedule_eps</code>. This calculation is repeated for every time step in the development of the patch. A new cohort is introduced immediately prior to any cohort failing these tests. The dynamics of the patch are then simulated again and the process is repeated, until all integrations at all time points have an error below the tolerable limit <code>schedule_eps</code>. Decreasing <code>schedule_eps</code> demands higher accuracy from the solver, and thus increases the number of cohorts being introduced. Note that we are assessing whether removing an existing cohort causes the error to jump above the threshold limit, and using this to decide whether an extra cohort – in addition to the one used in the test – should be introduced. Thus, the actual error is likely to be lower than, but at most equal to, <code>schedule_eps</code>. The general idea of adaptively refining the vector of introduction times was first applied by <span class="citation">Falster et al. (2011)</span>, and was described further by <span class="citation">Falster et al. (2015)</span>.</p>
<p>To determine the error associated with a given cohort, we integrate two different functions over the size-density distribution, within the function <code>run_scm_error</code>. We then assess how much removing the focal cohort increases the error in these two integrations. The first integration, performed by the function <code>area_leaf_error</code>, determines how much the removal of the focal cohort increases the error in the estimate of the total leaf area in the patch. The second integration, performed by the function <code>seed_rain_error</code>, determines how much the removal of the focal cohort increases the error in the estimate of the total seed production from the patch. The relative error in each integration is then calculated using the <code>local_error_integration</code> function.</p>
<p>For a worked example illustrating the <code>build_schedule</code> function, see the section <code>cohort_spacing</code> of Appendix S3.</p>
</div>
<div id="calculation-of-light-environment-and-influence-on-assimilation" class="section level3">
<h3 class="hasAnchor">
<a href="#calculation-of-light-environment-and-influence-on-assimilation" class="anchor"></a>Calculation of light environment and influence on assimilation</h3>
<p>To progress with solving the system of ODEs requires that we calculate the amount of shading on each of the cohorts, from all other plants in the patch.</p>
<p>Calculating the canopy openness <span class="math inline">\(E_a(z)\)</span> at a given height <span class="math inline">\(z\)</span> in a patch of age <span class="math inline">\(a\)</span> requires that we integrate over the size-density distribution (Eq. <a href="#eq:light">(4)</a>. This integration is performed using the trapezium rule, within the function <code>area_leaf_above</code> in <a href="https://github.com/traitecoevo/plant/blob/master/inst/include/plant/species.h">species.h</a>. The main factor controlling the accuracy of the integration is the spacing of cohorts. The cohort introduction times determining the spacing of cohorts are adaptively refined as described above. This implies that also the trapezium integration within the <code>area_leaf_above</code> function is adaptively refined via the <code>build_schedule</code> function.</p>
<p>The cost of calculating <span class="math inline">\(E_a(z)\)</span> linearly increases with the number of cohorts in the metacommunity. Since the same calculation must be repeated for every cohort, the overall computational cost of a step increases as <span class="math inline">\(O(k^2 )\)</span>, where <span class="math inline">\(k\)</span> is the total number of cohorts across all species. This disproportionate increase in computational cost with the number of cohorts is highly undesirable.</p>
<p>We reduce the computational cost from <span class="math inline">\(O(k^2)\)</span> to <span class="math inline">\(O(k)\)</span> by approximating <span class="math inline">\(E_a(z)\)</span> with a spline. Eq. <a href="#eq:light">(4)</a> describes a function monotonically increasing with size. This function is easily approximated using a piecewise continuous spline fitted to a limited number of points. Once fitted, the spline can be used to estimate any additional evaluations of competitive effect. Since spline evaluations are computationally cheaper than integrating over the size-density distribution, this approach reduces the overall cost of stepping the resident population. A new spline is constructed for each time step.</p>
<p>The accuracy of the spline interpolation depends on the number of points used in its construction and on their placement along the size axis. We select the number and locations of points via an adaptive algorithm. Starting with an initial set of 33 points, we assess how much each point contributes to the accuracy of the spline fit at the location of each cohort, first via exact calculation, and second by linearly interpolating from adjacent cohorts. The absolute difference in these values is compared to the control parameter <code>environment_light_tol</code>. If the error is greater than this tolerance, the interval is bisected and the is process repeated (see <a href="https://github.com/traitecoevo/plant/blob/master/inst/include/plant/adaptive_interpolator.h">adaptive_interpolator.h</a> for details).</p>
</div>
<div id="integrating-over-light-environment" class="section level3">
<h3 class="hasAnchor">
<a href="#integrating-over-light-environment" class="anchor"></a>Integration over light environment</h3>
<p>Plants have leaf area distributed over a range of heights. Estimating a plant’s assimilation at each time step thus requires integrating leaf-level rates over the plant. The integration is performed using Gaussian quadrature, using the QUADPACK routines <span class="citation">(Piessens, Doncker-Kapenga, Überhuber, &amp; Kahaner, 1983)</span> adapted from the <a href="http://www.gnu.org/software/gsl/">GNU Scientific Library</a> <span class="citation">(Galassi, 2009)</span>; see <a href="https://github.com/traitecoevo/plant/blob/master/inst/include/plant/qag.h">qag.h</a> for details. If the control parameter <code>plant_assimilation_adaptive</code> is <code>TRUE</code>, the integration is performed using adaptive refinement with an accuracy controlled by the parameter <code>plant_assimilation_tol</code>.</p>
</div>
<div id="solving-demographic-seed-rain" class="section level3">
<h3 class="hasAnchor">
<a href="#solving-demographic-seed-rain" class="anchor"></a>Solving for seed rains</h3>
<p>For a single species, solving for <span class="math inline">\(Y_x\)</span> is a straightforward one-dimensional root-finding problem, which can be solved with accuracy <code>equilibrium_eps</code> via a simple bisection algorithm (see <a href="https://github.com/traitecoevo/plant/blob/master/R/equilibrium.R">equlibrium.R</a> for details).</p>
<p>Solving for seed rains in metacommunities with multiple species is significantly harder, because there is no generally applicable method for multi-dimensional root finding. In <code>plant</code>, we have therefore implemented several different approaches (see <a href="https://github.com/traitecoevo/plant/blob/master/R/equilibrium.R">equlibrium.R</a> for details).</p>
</div>
</div>
</div>
<div id="appendices" class="section level1">
<h1 class="hasAnchor">
<a href="#appendices" class="anchor"></a>Appendices</h1>
<div id="derivation-of-pde-describing-age-structured-dynamics" class="section level2">
<h2 class="hasAnchor">
<a href="#derivation-of-pde-describing-age-structured-dynamics" class="anchor"></a>Derivation of PDE describing age-structured dynamics</h2>
We consider patches of habitat that are subject to an intermittent disturbance, with the age of a patch measuring the time since the last disturbance. Denoting by <span class="math inline">\(P(a, t)\)</span> the frequency-density of patch age <span class="math inline">\(a\)</span> at time <span class="math inline">\(t\)</span> and by <span class="math inline">\(d_{\rm P}(a)\)</span> the age-dependent probability that a patch of age <span class="math inline">\(a\)</span> is transformed into a patch of age <span class="math inline">\(0\)</span> through disturbance, the dynamics of <span class="math inline">\(P(a, t)\)</span> are given by
<span class="math display" id="eq:dp-a">\[\begin{equation}
 \frac{\partial}{\partial t} P(a, t) = -\frac{\partial}{\partial a} P(a, t)-d_{\rm P}(a, t) P(a, t),
\tag{33}
\end{equation}\]</span>
with boundary condition
<span class="math display" id="eq:p0">\[\begin{equation}
 P(0, t) = \int^{\infty}_{0}d_{\rm P}(a, t) P(a, t) \, {\rm d}a.
\tag{34}
\end{equation}\]</span>
The frequency-density of patches of age <span class="math inline">\(a &lt; a^{\prime}\)</span> is given by <span class="math inline">\(\int_{0}^{a^{\prime}}P(a, t) \, {\rm d}a\)</span>, with <span class="math inline">\(\int_{0}^{\infty} P(a, t) \, {\rm d}a = 1\)</span>. If <span class="math inline">\(\frac{\partial}{\partial t}d_{\rm P}(a, t) = 0\)</span>, then <span class="math inline">\(P(a)\)</span> will approach an equilibrium solution given by
<span class="math display" id="eq:pa">\[\begin{equation}
P(a) = P(0) \, S_{\rm P}(0, a),
\tag{35}
\end{equation}\]</span>
where
<span class="math display" id="eq:S-P">\[\begin{equation}
S_{\rm P}(0, a) = \exp \left( - \int_{0}^{a} d_{\rm P}(a^\prime) \, {\rm d}a^\prime\right)
\tag{36}
\end{equation}\]</span>
is the probability that a patch remains undisturbed for duration <span class="math inline">\(a\)</span>, and
<span class="math display" id="eq:p0-eq">\[\begin{equation}
P(0) = \frac1{ \int_{0}^{\infty}S_{\rm P}(0, a) \, {\rm d}a}
\tag{37}
\end{equation}\]</span>
<p>is the frequency-density of patches of age <span class="math inline">\(0\)</span>. The rate of disturbance for patches of age <span class="math inline">\(a\)</span> is given by <span class="math inline">\(\frac{\partial (1-S_{\rm P}(0, a))}{\partial a} = - \frac{\partial S_{\rm P}(0, a)}{\partial a}\)</span>, while the expected lifetime of patches is <span class="math inline">\(- \int_0^\infty a \frac{\partial}{\partial a} S_{\rm P}(0, a) \, {\rm d} a = \int_0^\infty S_{\rm P}(0, a) \, {\rm d} a = \frac1{P(0)}\)</span> (first step made using integration by parts).</p>
<p>An equilibrium distribution of patch ages may be achieved under a variety of conditions, for example, if <span class="math inline">\(d_{\rm P}(a, t)\)</span> depends on patch age <span class="math inline">\(a\)</span> but not on time <span class="math inline">\(t\)</span>. The rate of disturbance may also depend on features of the vegetation in the patch, rather than on patch age directly, in which case an equilibrium distribution of patch ages can still arise, provided the vegetation is also assumed to be at equilibrium.</p>
<div id="exponential-distribution" class="section level3">
<h3 class="hasAnchor">
<a href="#exponential-distribution" class="anchor"></a>Exponential distribution</h3>
If the rate <span class="math inline">\(d_{\rm P}\)</span> of patch disturbance is constant with respect to patch age, then the rates at which patches of age <span class="math inline">\(a\)</span> are disturbed follow an exponential distribution, <span class="math inline">\(-\partial S_{\rm P}(0, a)/ \partial a = d_{\rm P} \, \exp(-d_{\rm P} a)\)</span>. The distribution of patch ages is then given by
<span class="math display" id="eq:S-P0a1">\[\begin{equation}
 S_{\rm P}(0, a) = \exp\left(-d_{\rm P} a\right), \, P(0) = d_{\rm P}.
\tag{38}
\end{equation}\]</span>
</div>
<div id="weibull-distribution" class="section level3">
<h3 class="hasAnchor">
<a href="#weibull-distribution" class="anchor"></a>Weibull distribution</h3>
If the rate of patch disturbance changes with patch age according to <span class="math inline">\(d_{\rm P}(a) = \lambda \psi a^{\psi-1}\)</span>, then the rates at which patches of age <span class="math inline">\(a\)</span> are disturbed follow a Weibull distribution, <span class="math inline">\(-\partial S_{\rm P}(0, a)/ \partial a = \lambda \psi a^{\psi -1}e^{-\lambda a^\psi}\)</span>. <span class="math inline">\(\psi&gt;1\)</span> implies that the probability of disturbance increases with patch age, while <span class="math inline">\(\psi&lt;1\)</span> implies that it decreases with patch age. For <span class="math inline">\(\psi = 1\)</span>, we obtain the exponential distribution, a special case of the Weibull distribution. The Weibull distribution results in the following distribution of patch ages,
<span class="math display" id="eq:S-P0a2">\[\begin{equation}
S_{\rm P}(0, a) = \exp(-\lambda a^\psi), \, P(0) = \frac{\psi \lambda^{\frac1{\psi}}}{\Gamma\left(\frac1{\psi}\right)},
\tag{39}
\end{equation}\]</span>
<p>where <span class="math inline">\(\Gamma(x) = \int_{0}^{\infty}e^{-t}t^{x-1} \, dt\)</span> is the gamma function. We can also specify this distribution by the mean disturbance interval <span class="math inline">\(\bar{a} = \frac1{P(0)}\)</span>. From this, we can calculate the relevant value for <span class="math inline">\(\lambda = \left(\frac{\Gamma\left(\frac1{\psi}\right)}{\psi \bar{a}}\right)^{\psi}\)</span>.</p>
<p>The default in <code>plant</code> is to assume <span class="math inline">\(\psi=2\)</span>, such that <span class="math inline">\(d_{\rm P}\)</span> increases as a linear function of patch age. The distribution of patch ages is then specified by a single parameter, <span class="math inline">\(\bar{a}\)</span>.</p>
</div>
</div>
<div id="derivation-of-pde-describing-size-structured-dynamics" class="section level2">
<h2 class="hasAnchor">
<a href="#derivation-of-pde-describing-size-structured-dynamics" class="anchor"></a>Derivation of PDE describing size-structured dynamics</h2>
To model the metacommunity, we use a PDE describing the dynamics for a thin slice <span class="math inline">\(\Delta H\)</span>. This PDE can be derived as follows, following <span class="citation">De Roos et al. (1997)</span>. Note that in this sub-section the dependencies on the traits <span class="math inline">\(x\)</span> are deliberately not made explicit. Assuming that all rates are constant within the interval <span class="math inline">\(\Delta H\)</span>, the total number of individuals within the interval spanned by <span class="math inline">\([H - 0.5\Delta H, H + 0.5\Delta H)\)</span> is <span class="math inline">\(N(H, a)\Delta H\)</span>. The flux of individuals in and out of this size interval can be expressed as
<span class="math display" id="eq:flux-1">\[\begin{equation}\begin{array}{ll} &amp;g(H - 0.5 \Delta H, a) \, N(H - 0.5 \Delta H, a) - g(H + 0.5 \Delta H, a) \, N(H + 0.5 \Delta H, a) \\ &amp; - d (H, a) \, N(H, a)\Delta H\\ \end{array}.
\tag{40}
\end{equation}\]</span>
The first two terms describe the flux in and out of the considered size interval through growth, while the last term describes losses through mortality. The change in the density of individuals within this size interval during a time step $$a is thus
<span class="math display" id="eq:flux-2">\[\begin{equation}
\begin{array}{ll} N(H, a + \Delta a)\Delta H - N(H, a)\Delta H = &amp;g(H - 0.5 \Delta H, a) \, N(H - 0.5 \Delta H, a)\Delta a \\ &amp; - g(H + 0.5 \Delta H, a) \, N(H + 0.5 \Delta H, a)\Delta a\\&amp; - d (H, a) \, N(H, a)\Delta H\Delta a.
\end{array}
\tag{41}
\end{equation}\]</span>
By rearranging, we obtain
<span class="math display" id="eq:flux-3">\[\begin{equation}
\begin{array}{ll}
\frac{N(H, a + \Delta a) - N(H, a)}{\Delta a} = &amp; - d (H, a) \, N(H, a) \\
&amp; - \frac{g(H + 0.5 \Delta H, a) \, N(H + 0.5 \Delta H, a) - g(H - 0.5 \Delta H, a) \, N(H - 0.5 \Delta H, a)}{\Delta H}.
\end{array}
\tag{42}
\end{equation}\]</span>
The left-hand side above corresponds to the derivative of <span class="math inline">\(N\)</span> as <span class="math inline">\(\Delta a\to 0\)</span>. For thin slices, <span class="math inline">\(\Delta H \to 0\)</span>, this yields
<span class="math display" id="eq:PDE-app">\[\begin{equation}
\frac{\partial}{\partial a} N(H, a) = - d (H, a) \, N(H, a) - \frac{\partial}{\partial H} (g(H, a) \, N(H, a)).
\tag{43}
\end{equation}\]</span>
To complete the model, this PDE must be supplemented with boundary conditions that specify the density at the lower end of heights for all <span class="math inline">\(a\)</span>, as well as the initial distribution <span class="math inline">\(N(H,0)\)</span>. The former is derived by integrating the PDE with respect to <span class="math inline">\(H\)</span> over the interval <span class="math inline">\((H_{0}, H_{\infty} )\)</span>, yielding
<span class="math display" id="eq:partial-a">\[\begin{equation}\frac{\partial}{\partial a} \int _{H_{0} }^{H_{\infty}}N(H, a) \, {\rm d} H = g(H_{0} , a) \, N(H_{0} , a) - g(H_{\infty}, a) \, N(H_{\infty}, a) - \int _{H_{0} }^{H_{\infty}}d (H, a) \, N(H, a) \, {\rm d} H.
\tag{44}
\end{equation}\]</span>
The left-hand size above is evidently the rate of change of the total density of individuals in the population, while the right-hand side is the population’s total death rate. Further, we can assume that <span class="math inline">\(N(H_{\infty}, a) = 0\)</span>. Thus, to balance total births and deaths, <span class="math inline">\(g(H_{0} , a) \, N(H_{0} , a)\)</span> must equal the population’s total birth rate <span class="math inline">\(B\)</span>, yielding the boundary condition
<span class="math display" id="eq:g0">\[\begin{equation}g(H_{0} , a) \, N(H_{0} , a) = B.
\tag{45}
\end{equation}\]</span>
</div>
<div id="converting-density-from-one-size-unit-to-another" class="section level2">
<h2 class="hasAnchor">
<a href="#converting-density-from-one-size-unit-to-another" class="anchor"></a>Converting density from one size unit to another</h2>
The quantification of size-density depends on the chosen size unit (Eq. <a href="#eq:PDE">(5)</a>). Thus, what if we want to express size-density with respect to another size unit? A relation between the two corresponding values of size-density can be derived by noting that the total density of individuals within a given size range must be equal. We consider a situation in which size-density is expressed in units of size <span class="math inline">\(M\)</span>, but we want it in units of size <span class="math inline">\(H\)</span>. First, we require a one-to-one function that translates the first size unit into the second, <span class="math inline">\(H = \hat{H}(M)\)</span>. Then the following must hold
<span class="math display" id="eq:n-conversion">\[\begin{equation}
\int_{M_1}^{M_2} N(M | x, a) \, {\rm d}M = \int_{\hat{H}(M_1)}^{\hat{H}(M_2)} N^\prime(H | x, a) \, {\rm d}H .
\tag{46}
\end{equation}\]</span>
For very small size intervals, this equation is equivalent to
<span class="math display" id="eq:n-conversion2">\[\begin{equation}\left(M_2 - M_1 \right) \, N(M_1 | x, a) = \left( \hat{H}(M_2) - \hat{H}(M_1)\right) \, N^\prime(\hat{H}(M_1) | x, a).
\tag{47}
\end{equation}\]</span>
Rearranging gives
<span class="math display" id="eq:n-conversion3">\[\begin{equation}N^\prime(\hat{H}(M_1) | x, a) = N(M_1 | x, a) \, \frac{M_2 - M_1}{\hat{H}(M_2) - \hat{H}(M_1)}.
\tag{48}
\end{equation}\]</span>
Noting that the second term on the right-hand side is simply the definition of <span class="math inline">\(\frac{{\rm d} M}{{\rm d} H}\)</span> evaluated at <span class="math inline">\(M_1\)</span>, we have
<span class="math display" id="eq:n-conversion4">\[\begin{equation}
N^\prime(H | x, a) = N(M | x, a) \, \frac{{\rm d} M}{{\rm d} H}.
\tag{49}
\end{equation}\]</span>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Abramowitz-2012">
<p>Abramowitz, M., &amp; Stegun, I. A. (2012). <em>Handbook of mathematical functions: With formulas, graphs, and mathematical tables</em>. Courier Corporation.</p>
</div>
<div id="ref-Angulo-2004">
<p>Angulo, &amp; López-Marcos. (2004). Numerical integration of fully nonlinear size-structured population models. <em>Applied Numerical Mathematics</em>, <em>50</em>(3-4), 291–327. doi:<a href="https://doi.org/10.1016/j.apnum.2004.01.007">10.1016/j.apnum.2004.01.007</a></p>
</div>
<div id="ref-Angulo-2014">
<p>Angulo, O., López-Marcos, J. C., &amp; López-Marcos, M. A. (2014). Analysis of an efficient integrator for a size-structured population model with a dynamical resource. <em>Computers &amp; Mathematics with Applications</em>, <em>68</em>(9), 941–961. doi:<a href="https://doi.org/10.1016/j.camwa.2014.04.009">10.1016/j.camwa.2014.04.009</a></p>
</div>
<div id="ref-Angulo-2016">
<p>Angulo, O., López-Marcos, J. C., &amp; López-Marcos, M. A. (2016). Study on the efficiency in the numerical integration of size-structured population models: Error and computational cost. <em>Journal of Computational and Applied Mathematics</em>, <em>291</em>, 391–401. doi:<a href="https://doi.org/10.1016/j.cam.2015.03.022">10.1016/j.cam.2015.03.022</a></p>
</div>
<div id="ref-Cash-1990">
<p>Cash, J. R., &amp; Karp, A. H. (1990). A variable order Runge-Kutta method for initial value problems with rapidly varying right-hand sides. <em>ACM Transactions on Mathematical Software</em>, <em>16</em>(3), 201–222. doi:<a href="https://doi.org/10.1145/79505.79507">10.1145/79505.79507</a></p>
</div>
<div id="ref-Deroos-1988">
<p>De Roos, A. M. (1988). Numerical methods for structured population models: The Escalator Boxcar Train. <em>Numerical Methods for Partial Differential Equations</em>, <em>4</em>(3), 173–195. doi:<a href="https://doi.org/10.1002/num.1690040303">10.1002/num.1690040303</a></p>
</div>
<div id="ref-Deroos-1992">
<p>De Roos, A. M., Diekmann, O., &amp; Metz, J. A. J. (1992). Studying the dynamics of structured population models: A versatile technique and its application to daphnia. <em>American Naturalist</em>, <em>139</em>(1), 123. doi:<a href="https://doi.org/abs/10.1086/285316">abs/10.1086/285316</a></p>
</div>
<div id="ref-Deroos-1997">
<p>De Roos, A. M., Taljapurkar, S., &amp; Caswell, H. (1997). A gentle introduction to physiologically structured population models. In <em>Structured population models in marine, terrestrial and fresh-water systems</em> (pp. 119–204). New York: Chapman &amp; Hall.</p>
</div>
<div id="ref-Eddelbuettel-2015">
<p>Eddelbuettel, D., Emerson, J. W., &amp; Kane, M. J. (2015). <em>BH: Boost c++ header files</em>. Retrieved from <a href="http://CRAN.R-project.org/package=BH" class="uri">http://CRAN.R-project.org/package=BH</a></p>
</div>
<div id="ref-Falster-2011">
<p>Falster, D. S., Brännström, Å., Dieckmann, U., &amp; Westoby, M. (2011). Influence of four major plant traits on average height, leaf-area cover, net primary productivity, and biomass density in single-species forests: A theoretical investigation. <em>Journal of Ecology</em>, <em>99</em>(1), 148–164. doi:<a href="https://doi.org/10.1111/j.1365-2745.2010.01735.x">10.1111/j.1365-2745.2010.01735.x</a></p>
</div>
<div id="ref-Falster-2015">
<p>Falster, D. S., Brännström, Westoby, M., &amp; Dieckmann, U. (2015). Multi-trait eco-evolutionary dynamics explain niche diversity and evolved neutrality in forests. <em>bioRxiv</em>, 014605. doi:<a href="https://doi.org/10.1101/014605">10.1101/014605</a></p>
</div>
<div id="ref-Vonfoerster-1959">
<p>Foerster, H. V. (1959). Some remarks on changing populations. In F. Stohlman (Ed.), <em>The kinetics of cellular proliferation</em> (pp. 382–407). Grune et Stratton, New York.</p>
</div>
<div id="ref-Galassi-2009">
<p>Galassi, M. (Ed.). (2009). <em>GNU scientific library: Reference manual</em> (3. ed., for GSL version 1.12). s.l.: Network Theory.</p>
</div>
<div id="ref-Geritz-1998">
<p>Geritz, S. A. H., Kisdi, Meszéna, G., &amp; Metz, J. A. J. (1998). Evolutionarily singular strategies and the adaptive growth and branching of the evolutionary tree. <em>Evolutionary Ecology</em>, <em>12</em>(1), 35–57. doi:<a href="https://doi.org/10.1023/A:1006554906681">10.1023/A:1006554906681</a></p>
</div>
<div id="ref-Gyllenberg-2001">
<p>Gyllenberg, M., &amp; Metz, J. A. J. (2001). On fitness in structured metapopulations. <em>Journal of Mathematical Biology</em>, <em>43</em>(6), 545–560.</p>
</div>
<div id="ref-Kohyama-1993">
<p>Kohyama, T. (1993). Size-structured tree populations in gap-dynamic forest: The forest architecture hypothesis for the stable coexistence of species. <em>Journal of Ecology</em>, <em>81</em>(1), 131–143.</p>
</div>
<div id="ref-Mckendrick-1926">
<p>McKendrick, A. G. (1926). Applications of mathematics to medical problems. <em>Proceedings of the Edinburgh Mathematical Society</em>, <em>44</em>, 1–34.</p>
</div>
<div id="ref-Metz-2001">
<p>Metz, J. A. J., &amp; Gyllenberg, M. (2001). How should we define fitness in structured metapopulation models? Including an application to the calculation of evolutionarily stable dispersal strategies. <em>Proceedings of the Royal Society of London - Series B: Biological Sciences</em>, <em>268</em>(1466), 499–508.</p>
</div>
<div id="ref-Metz-1992">
<p>Metz, J. A. J., Nisbet, R. M., &amp; Geritz, S. A. H. (1992). How should we define ’fitness’ for general ecological scenarios? <em>Trends in Ecology and Evolution</em>, <em>7</em>(6), 198–202. doi:<a href="https://doi.org/10.1016/0169-5347(92)90073-K">10.1016/0169-5347(92)90073-K</a></p>
</div>
<div id="ref-Moorcroft-2001">
<p>Moorcroft, P. R., Hurtt, G. C., &amp; Pacala, S. W. (2001). A method for scaling vegetation dynamics: The Ecosystem Demography model (ED). <em>Ecological Monographs</em>, <em>71</em>(4), 557–586. doi:<a href="https://doi.org/10.1890/0012-9615(2001)071%5B0557:AMFSVD%5D2.0.CO;2">10.1890/0012-9615(2001)071[0557:AMFSVD]2.0.CO;2</a></p>
</div>
<div id="ref-Piessens-1983">
<p>Piessens, R., Doncker-Kapenga, E. D., Überhuber, C., &amp; Kahaner, D. (1983). <em>QUADPACK, a subroutine package for automatic integration</em>. Berlin Heidelberg: Springer.</p>
</div>
<div id="ref-Schaling-2014">
<p>Schäling, B. (2014). <em>The Boost C++ libraries</em> (2nd ed.). XML Press.</p>
</div>
<div id="ref-Stoer-2002">
<p>Stoer, J., &amp; Bulirsch, R. (2002). <em>Introduction to numerical analysis</em>. Springer Science &amp; Business Media.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#system-dynamics">Metacommunity dynamics</a><ul class="nav nav-pills nav-stacked">
<li><a href="#individual-plants">Individual plants</a></li>
      <li><a href="#patches-of-competing-plants-size-structured-populations">Patches of competing plants</a></li>
      <li><a href="#age-structured-distribution-of-patches">Age structure of patches</a></li>
      <li><a href="#trait--size--and-patch-structured-metapopulations">Trait-, size-, and patch-structured metacommunities</a></li>
      <li><a href="#emergent-properties-of-metapopulation">Emergent properties of metacommunities</a></li>
      <li><a href="#invasion-fitness">Invasion fitness</a></li>
      </ul>
</li>
      <li>
<a href="#numerical-methods-for-solving-metacommunity-dynamics">Numerical methods for solving metacommunity dynamics</a><ul class="nav nav-pills nav-stacked">
<li><a href="#approach">Approach</a></li>
      <li><a href="#controls-on-approximation-error">Controls on approximation error</a></li>
      </ul>
</li>
      <li>
<a href="#appendices">Appendices</a><ul class="nav nav-pills nav-stacked">
<li><a href="#derivation-of-pde-describing-age-structured-dynamics">Derivation of PDE describing age-structured dynamics</a></li>
      <li><a href="#derivation-of-pde-describing-size-structured-dynamics">Derivation of PDE describing size-structured dynamics</a></li>
      <li><a href="#converting-density-from-one-size-unit-to-another">Converting density from one size unit to another</a></li>
      </ul>
</li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Daniel Falster, Richard FitzJohn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
